Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 1
border.asm



      1				     ;------------------------------------------------------------------------------
      2				     ;			      Card for Saint Valentine's Day (aka frame)
      3				     ;			     @Rogov Anatoliy 08.02.2025	"Sivchuk Bad Day"
      4				     ;------------------------------------------------------------------------------
      5
      6	      =0081		     cmd_line_add	     = 0081h								    +
      7				     ;cmd line address
      8	      =B800		     video_segment	     = 0b800h								    +
      9				     ;video segment
     10	      =0050		     window_len			     = 80							    +
     11				     ;window row length
     12	      =0019		     window_height	     = 25								    +
     13				     ;window column height
     14
     15	0000			     .model tiny										    +
     16				     ;set 64 Kb	model
     17	0000			     .code											    +
     18				     ;define code block
     19				     org 100h											    +
     20				     ;prog's beginning ram block
     21
     22	0100  33 C0		     Start:  xor ax, ax										    +
     23				     ;ax = 0
     24	0102  8E C0				     mov es, ax									    +
     25				     ;es = 0
     26	0104  BB 0024				     mov bx, 09h * 4								    +
     27				     ;bx = &int	09h
     28
     29	0107  26: 8B 07				     mov ax, es:[bx]								    +
     30				     ;ax = old09h offset
     31	010A  A3 016Cr				     mov old09ofs, ax								    +
     32				     ;old09fs =	ax
     33	010D  26: 8B 47	02			     mov ax, es:[bx + 2]							    +
     34				     ;ax = old09h segment
     35	0111  A3 016Er				     mov old09seg, ax								    +
     36				     ;old09seg = ax
     37
     38	0114  26: C7 07	0130r			     mov es:[bx], offset New09h							    +
     39				     ;change 09h interrupt function by mine
     40	0119  8C C8				     mov ax, cs									    +
     41				     ;ax = cs
     42	011B  26: 89 47	02			     mov es:[bx	+ 2], ax							    +
     43				     ;current segment
     44
     45	011F  B8 3100				     mov ax, 3100h								    +
     46				     ;make program resident
     47	0122  BA 0067r				     mov dx, offset EOP								    +
     48				     ;dx = &EOP
     49	0125  D1 EA D1 EA D1 EA	D1+		     shr dx, 4									    +
     50	      EA		     ;dx /= 4
     51	012D  42				     inc dx									    +
     52				     ;dx += 1
     53	012E  CD 21				     int 21h									    +
     54				     ;31 function of 21	interrupt
     55
     56				     ;------------------------------------------------------------------------------
     57				     ; New procedural handler of 09h interrupt
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 2
border.asm



     58				     ; Entry:		     NONE
     59				     ; Exit:		     NONE
     60				     ; Destroyed:    NONE
     61				     ;------------------------------------------------------------------------------
     62
     63	0130			     New09h  proc
     64	0130  50 53 51 52 06 56	55		     push ax bx	cx dx es si bp							    +
     65				     ;save all registers
     66
     67	0137  E4 60				     in	al, 60h									    +
     68				     ;al = scan	code from 60h port
     69	0139  3C 58				     cmp al, 58h								    +
     70				     ;if (al ==	F12) zf	= 1
     71	013B  75 17				     jne skip									    +
     72				     ;if (zf !=	1) goto	skip --------|
     73	013D  50 53 51 52 06 56	55+			     push ax bx	cx dx es si bp ds				     ;save  +
     74	      1E		     all registers			       |
     75																    +
     76				     ;								     |
     77	0145  8C CB					     mov bx, cs								    +
     78				     ;bx = code	segment				     |
     79	0147  8E DB					     mov ds, bx								    +
     80				     ;data segment = code segment    |
     81	0149  E8 0024					     call MainBorder							    +
     82				     ;Main Border function		     |
     83																    +
     84				     ;								     |
     85	014C  1F 5D 5E 07 5A 59	5B+			     pop ds bp si es dx	cx bx ax					    +
     86	      58		     ;return all registers		     |
     87	0154					     skip:									    +
     88				     ;<------------------------------|
     89
     90						     ;say that ready to	input new button by blink the bit
     91	0154  E4 61				     in	al, 61h									    +
     92				     ;al = value from 61h keyboard port
     93	0156  8A E0				     mov ah, al									    +
     94				     ;ah = al
     95	0158  0C 80				     or	al, 80h									    +
     96				     ;set the highest bit
     97	015A  E6 61				     out 61h, al								    +
     98				     ;out al to	61h keyboard port
     99	015C  8A C4				     mov al, ah									    +
    100				     ;al = ah
    101	015E  E6 61				     out 61h, al								    +
    102				     ;out al to	61h keyboard port
    103
    104	0160  B0 20				     mov al, 20h								    +
    105				     ;non-specific end of interrupt
    106	0162  E6 20				     out 20h, al								    +
    107				     ;interrupt	controller port
    108
    109	0164  5D 5E 07 5A 59 5B	58		     pop bp si es dx cx	bx ax							    +
    110				     ;return all registers after interrupt
    111	016B  EA					     db	0eah								    +
    112				     ;jump to old procedural handler of	09h interrupt
    113	016C  0000		     old09ofs	     dw	0									    +
    114				     ;previous offset
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 3
border.asm



    115	016E  0000		     old09seg	     dw	0									    +
    116				     ;in segment
    117	0170					     endp
    118
    119				     ;------------------------------------------------------------------------------
    120
    121				     ;------------------------------------------------------------------------------
    122				     ; Main Border
    123				     ; Entry:		     None
    124				     ; Exit:		     SI
    125				     ; Destroyed:    SI, BP, BX, DX
    126				     ;------------------------------------------------------------------------------
    127
    128	0170			     MainBorder	     proc
    129
    130	0170  33 C0					     xor ax, ax								    +
    131				     ;ax = 0
    132	0172  33 DB					     xor bx, bx								    +
    133				     ;bx = 0
    134	0174  33 C9					     xor cx, cx								    +
    135				     ;cx = 0
    136	0176  33 D2					     xor dx, dx								    +
    137				     ;dx = 0
    138
    139	0178  BB B800					     mov bx, video_segment						    +
    140				     ;bx = video segment position
    141	017B  8E C3					     mov es, bx								    +
    142				     ;es = bx
    143	017D  BE 0081					     mov si, cmd_line_add						    +
    144				     ;si = cmd_line
    145
    146							     ;call EnterData							    +
    147				     ;len, height
    148	0180  E8 010F					     call CalcParam							    +
    149				     ;x_start, y_start,	y_string
    150	0183  E8 0011					     call SetStyle							    +
    151				     ;calculate	si
    152
    153	0186  8A 36 0001r				     mov dh, height							    +
    154				     ;dh = height
    155	018A  8A 16 0000r				     mov dl, len							    +
    156				     ;dl = len
    157	018E  33 FF					     xor di, di								    +
    158				     ;di = 0;
    159	0190  E8 016C					     call DrawFrame							    +
    160				     ;Drawing frame
    161	0193  E8 0051					     call DrawString							    +
    162				     ;Drawing string inside frame
    163
    164	0196  C3					     ret								    +
    165				     ;return function value
    166	0197						     endp								    +
    167				     ;proc's ending
    168
    169				     ;------------------------------------------------------------------------------
    170
    171				     ;------------------------------------------------------------------------------
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 4
border.asm



    172				     ; Set frame style
    173				     ; Entry:		     None
    174				     ; Exit:		     SI
    175				     ; Destroyed:    SI, BP, BX, DX
    176				     ;------------------------------------------------------------------------------
    177
    178	0197			     SetStyle	     proc
    179
    180	0197  33 DB					     xor bx, bx								    +
    181				     ;bx = 0
    182	0199  8A 1E 0007r				     mov bl, frame_style						    +
    183				     ;bl = frame_style
    184
    185	019D  80 FB 00					     cmp bl, 0								    +
    186				     ;if (bl ==	0) jz =	1
    187	01A0  74 22					     je	own_style							    +
    188				     ;if (jz ==	1) goto	own_style
    189
    190	01A2  BD 0006r					     mov bp, offset str_data_pos					    +
    191				     ;bp = &str_data_pos
    192	01A5  33 D2					     xor dx, dx								    +
    193				     ;dx = 0
    194	01A7  BA 0050r					     mov dx, offset InsideString					    +
    195				     ;dx = &InsideString
    196	01AA  89 56 00					     mov [bp], dx							    +
    197				     ;str_data_pos = InsideString
    198	01AD  BD 0007r					     mov bp, offset frame_style						    +
    199				     ;bp = &frame_style
    200	01B0  80 EB 01					     sub bl, 1								    +
    201				     ;bl -= 1
    202	01B3  53					     push bx								    +
    203				     ;save bx
    204	01B4  D0 E3 D0 E3 D0 E3				     shl bl, 3								    +
    205				     ;bl *= 8
    206	01BA  5A					     pop dx								    +
    207				     ;return bx	to dx
    208	01BB  02 DA					     add bl, dl								    +
    209				     ;bl += dl
    210	01BD  FE C3					     inc bl								    +
    211				     ;bl += 1
    212	01BF  03 EB					     add bp, bx								    +
    213				     ;bp += bx
    214	01C1  8B F5					     mov si, bp								    +
    215				     ;si = bp
    216
    217	01C3  C3					     ret								    +
    218				     ;return function value
    219	01C4						     endp								    +
    220				     ;proc's ending
    221
    222	01C4						     own_style:
    223	01C4  56					     push si								    +
    224				     ;save si
    225	01C5  E8 00BC					     call SkipSpaces							    +
    226				     ;skip spaces
    227	01C8  E8 000E					     call SkipQuot							    +
    228				     ;skip while ne quot
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 5
border.asm



    229	01CB  E8 00B6					     call SkipSpaces							    +
    230				     ;skip spaces
    231	01CE  BD 0006r					     mov bp, offset str_data_pos					    +
    232				     ;bp = &str_data_pos
    233	01D1  89 76 00					     mov [bp], si							    +
    234				     ;str_data_pos = si
    235	01D4  5E					     pop si								    +
    236				     ;return si
    237	01D5  E8 00AC					     call SkipSpaces							    +
    238				     ;skip spaces on si
    239
    240	01D8  C3					     ret								    +
    241				     ;return function value
    242	01D9						     endp								    +
    243				     ;proc's ending
    244
    245				     ;------------------------------------------------------------------------------
    246
    247				     ;------------------------------------------------------------------------------
    248				     ; Skip quotation mark on si address
    249				     ; Entry:		     SI	- symbol on or before quotation	mark
    250				     ; Exit:		     SI	- first	symbol equal to	quotation mark
    251				     ; Destroyed:    CX, AL
    252				     ;------------------------------------------------------------------------------
    253
    254	01D9			     SkipQuot	     proc
    255
    256	01D9  B9 0001					     mov cx, 1								    +
    257				     ;cx = 1
    258
    259	01DC						     cmd_skip_quot:							    +
    260				     ;<----------------------------------|
    261	01DC  AC						     lodsb							    +
    262				     ;mov al, ds:[si]					     |
    263	01DD  3C 22						     cmp al, '"'						    +
    264				     ;if (al ==	' ') zf	= 1			     |
    265	01DF  74 05						     je	end_cmd_skip_quot					    +
    266				     ;if (zf ==	1) goto	end_cmd_skip_quot|
    267	01E1  83 C1 02						     add cx, 2							    +
    268				     ;cx += 2							     |
    269	01E4  E2 F6					     loop cmd_skip_quot							    +
    270				     ;-----------------------------------|
    271	01E6						     end_cmd_skip_quot:
    272
    273	01E6  C3					     ret								    +
    274				     ;return function value
    275	01E7						     endp								    +
    276				     ;proc's ending
    277
    278				     ;------------------------------------------------------------------------------
    279
    280				     ;------------------------------------------------------------------------------
    281				     ; Draw string inside the frame
    282				     ; Entry:		     None
    283				     ; Exit:		     None
    284				     ; Destroyed:    SI, BP, CX, AH
    285				     ;------------------------------------------------------------------------------
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 6
border.asm



    286
    287	01E7			     DrawString	     proc
    288
    289	01E7  BD 0006r					     mov bp, offset str_data_pos					    +
    290				     ;bp = &str_data_pos
    291	01EA  8B 76 00					     mov si, [bp]							    +
    292				     ;si = str_data_pos
    293	01ED  33 C9					     xor cx, cx								    +
    294				     ;cx = 0
    295	01EF  E8 00F9					     call StrLen							    +
    296				     ;cx = len(si)
    297
    298	01F2  BD 0006r					     mov bp, offset str_data_pos
    299	01F5  8B 76 00					     mov si, [bp]							    +
    300				     ;si = &inside frame string
    301	01F8  E8 00C3					     call EvalShift							    +
    302				     ;di = 2 * window_len * y_start + (x_start + (cx - len) / 2) * 2
    303
    304	01FB  8A 26 0002r				     mov ah, frame_color						    +
    305				     ;ah = string color
    306	01FF  E8 00F4					     call PrintInsideString
    307
    308	0202  C3					     ret								    +
    309				     ;return function value
    310	0203						     endp								    +
    311				     ;proc's ending
    312
    313				     ;------------------------------------------------------------------------------
    314
    315				     ;------------------------------------------------------------------------------
    316				     ; Enter the data for frame
    317				     ; Entry:		     None
    318				     ; Exit:		     None
    319				     ; Destroyed:    SI, BP
    320				     ;------------------------------------------------------------------------------
    321
    322	0203			     EnterData	     proc
    323
    324	0203  E8 007E					     call SkipSpaces							    +
    325				     ;skip spaces in cmd line
    326	0206  E8 0056					     call Atoi								    +
    327				     ;bl = integer
    328	0209  BD 0000r					     mov bp, offset len							    +
    329				     ;bp = &len
    330	020C  88 5E 00					     mov [bp], bl							    +
    331				     ;len = bl
    332
    333	020F  E8 0072					     call SkipSpaces							    +
    334				     ;skip spaces in cmd line
    335	0212  E8 004A					     call Atoi								    +
    336				     ;bl = integer
    337	0215  BD 0001r					     mov bp, offset height						    +
    338				     ;bp = &height
    339	0218  88 5E 00					     mov [bp], bl							    +
    340				     ;height = bl
    341
    342	021B  E8 0066					     call SkipSpaces							    +
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 7
border.asm



    343				     ;skip spaces in cmd line
    344	021E  E8 0013					     call Atoh								    +
    345				     ;bl = hex
    346	0221  BD 0002r					     mov bp, offset frame_color						    +
    347				     ;bp = &height
    348	0224  88 5E 00					     mov [bp], bl							    +
    349				     ;frame_color = bl
    350
    351	0227  E8 005A					     call SkipSpaces							    +
    352				     ;skip spaces in cmd line
    353	022A  E8 0032					     call Atoi								    +
    354				     ;bl = integer
    355	022D  BD 0007r					     mov bp, offset frame_style						    +
    356				     ;bp = &style
    357	0230  88 5E 00					     mov [bp], bl							    +
    358				     ;frame_style = bl
    359
    360	0233  C3					     ret								    +
    361				     ;return function value
    362	0234						     endp								    +
    363				     ;proc's ending
    364
    365				     ;------------------------------------------------------------------------------
    366
    367				     ;------------------------------------------------------------------------------
    368				     ; ASCII code symbols to hex integer (ABCDEF instead of abcdef)
    369				     ; Entry:		     AL	- first	symbol
    370				     ; Exit:		     BL	- hex
    371				     ; Destroyed:    CX, BX, DX, AX
    372				     ;------------------------------------------------------------------------------
    373
    374	0234			     Atoh    proc
    375
    376	0234  B9 0001				     mov cx, 1									    +
    377				     ;cx = 1
    378	0237  33 DB				     xor bx, bx									    +
    379				     ;bx = 0
    380	0239  33 D2				     xor dx, dx									    +
    381				     ;dx = 0
    382	023B  32 E4				     xor ah, ah									    +
    383				     ;ah = 0
    384
    385	023D					     get_hex:									    +
    386				     ;<--------------------------|
    387	023D  3C 20					     cmp al, ' '							    +
    388				     ;if (al ==	' ') zf	= 1	     |
    389	023F  74 1D					     je	end_atoh							    +
    390				     ;if (zf ==	1) goto	end_atoi     |
    391																    +
    392				     ;							     |
    393	0241  D1 E3 D1 E3 D1 E3	D1+			     shl bx, 4								    +
    394	      E3		     ;bx *= 16					     |
    395																    +
    396				     ;							     |
    397	0249  3C 41					     cmp al, 'A'							    +
    398				     ;if (al - 65 < 0) fs = 1	     |
    399	024B  79 06					     jns no_sign							    +
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 8
border.asm



    400				     ;if (fs !=	1) goto	no_sign	     |
    401	024D  2D 0030					     sub ax, '0'							    +
    402				     ;ax -= 48					     |
    403	0250  EB 04 90					     jmp both								    +
    404				     ;goto both					     |
    405	0253						     no_sign:								    +
    406				     ;							     |
    407	0253  2D 0037						     sub ax, 55							    +
    408				     ;ax -= 55					     |
    409	0256						     both:								    +
    410				     ;							     |
    411	0256  03 D8					     add bx, ax								    +
    412				     ;bx += ax					     |
    413																    +
    414				     ;							     |
    415	0258  83 C1 02					     add cx, 2								    +
    416				     ;cx += 2					     |
    417	025B  AC					     lodsb								    +
    418				     ;mov al, ds:[si]			     |
    419	025C  E2 DF				     loop get_hex								    +
    420				     ;---------------------------|
    421	025E					     end_atoh:
    422
    423	025E  C3				     ret									    +
    424				     ;return function value
    425	025F					     endp									    +
    426				     ;proc's ending
    427
    428				     ;------------------------------------------------------------------------------
    429
    430				     ;------------------------------------------------------------------------------
    431				     ; ASCII code symbols to integer
    432				     ; Entry:		     AL	- first	symbol
    433				     ; Exit:		     BL	- integer
    434				     ; Destroyed:    CX, BX, DX, AX
    435				     ;------------------------------------------------------------------------------
    436
    437	025F			     Atoi    proc
    438
    439	025F  B9 0001				     mov cx, 1									    +
    440				     ;cx = 1
    441	0262  33 DB				     xor bx, bx									    +
    442				     ;bx = 0
    443	0264  33 D2				     xor dx, dx									    +
    444				     ;dx = 0
    445	0266  32 E4				     xor ah, ah									    +
    446				     ;ah = 0
    447
    448	0268					     get_symbol:								    +
    449				     ;<--------------------------|
    450	0268  3C 20					     cmp al, ' '							    +
    451				     ;if (al ==	' ') zf	= 1	     |
    452	026A  74 17					     je	end_atoi							    +
    453				     ;if (zf ==	1) goto	end_atoi     |
    454																    +
    455				     ;							     |
    456	026C  53					     push bx								    +
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 9
border.asm



    457				     ;save bx					     |
    458	026D  D1 E3 D1 E3 D1 E3				     shl bx, 3								    +
    459				     ;bx *= 8					     |
    460																    +
    461				     ;							     |
    462	0273  5A					     pop dx								    +
    463				     ;return bx: dx = bx		     |
    464	0274  D1 E2					     shl dx, 1								    +
    465				     ;dx *= 2					     |
    466	0276  03 DA					     add bx, dx								    +
    467				     ;bx += dx					     |
    468																    +
    469				     ;							     |
    470	0278  2D 0030					     sub ax, 48								    +
    471				     ;ax -= 48					     |
    472	027B  03 D8					     add bx, ax								    +
    473				     ;bx += ax					     |
    474																    +
    475				     ;							     |
    476	027D  83 C1 02					     add cx, 2								    +
    477				     ;cx += 2					     |
    478	0280  AC					     lodsb								    +
    479				     ;mov al, ds:[si]			     |
    480	0281  E2 E5				     loop get_symbol								    +
    481				     ;---------------------------|
    482	0283					     end_atoi:
    483
    484	0283  C3				     ret									    +
    485				     ;return function value
    486	0284					     endp									    +
    487				     ;proc's ending
    488
    489				     ;------------------------------------------------------------------------------
    490
    491				     ;------------------------------------------------------------------------------
    492				     ; Skip spaces on cmd line address
    493				     ; Entry:		     SI	- string beginning with	' '(20)	space
    494				     ; Exit:		     SI	- first	non space symbol
    495				     ; Destroyed:    CX, AL
    496				     ;------------------------------------------------------------------------------
    497
    498	0284			     SkipSpaces	     proc
    499
    500	0284  B9 0001					     mov cx, 1								    +
    501				     ;cx = 1
    502
    503	0287						     cmd_skip_spc:							    +
    504				     ;<----------------------------------|
    505	0287  AC						     lodsb							    +
    506				     ;mov al, ds:[si]					     |
    507	0288  3C 20						     cmp al, ' '						    +
    508				     ;if (al ==	' ') zf	= 1			     |
    509	028A  75 05						     jne end_cmd_skip_spc					    +
    510				     ;if (zf ==	1) goto	end_cmd_skip_spc     |
    511	028C  83 C1 02						     add cx, 2							    +
    512				     ;cx += 2							     |
    513	028F  E2 F6					     loop cmd_skip_spc							    +
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 10
border.asm



    514				     ;-----------------------------------|
    515	0291						     end_cmd_skip_spc:
    516
    517	0291  C3					     ret								    +
    518				     ;return function value
    519	0292						     endp								    +
    520				     ;proc's ending
    521
    522				     ;------------------------------------------------------------------------------
    523
    524				     ;------------------------------------------------------------------------------
    525				     ; Calculate values	of variables: x_start, y_start,	y_string
    526				     ; Entry:		     None
    527				     ; Exit:		     None
    528				     ; Destroyed:    AX, BX, DX, BP
    529				     ;------------------------------------------------------------------------------
    530
    531	0292			     CalcParam	     proc
    532
    533	0292  A0 0000r					     mov al, len							    +
    534				     ;al = len
    535	0295  8A 16 0001r				     mov dl, height							    +
    536				     ;dl = height
    537	0299  B3 28					     mov bl, window_len	/ 2						    +
    538				     ;bp = 80 /	2
    539	029B  88 1E 0003r				     mov x_start, bl							    +
    540				     ;x_start =	40
    541	029F  D1 E8					     shr ax, 1								    +
    542				     ;ax /= 2
    543	02A1  28 06 0003r				     sub x_start, al							    +
    544				     ;x_start -= len / 2
    545
    546	02A5  B3 0C					     mov bl, window_height / 2						    +
    547				     ;bp = 25 /	2
    548	02A7  88 1E 0004r				     mov y_start, bl							    +
    549				     ;y_start =	25 / 2
    550	02AB  D1 EA					     shr dx, 1								    +
    551				     ;dx /= 2
    552	02AD  28 16 0004r				     sub y_start, dl							    +
    553				     ;y_start -= height	/ 2
    554
    555	02B1  8A 1E 0004r				     mov bl, y_start							    +
    556				     ;bp = y_start
    557	02B5  88 1E 0005r				     mov y_string, bl							    +
    558				     ;y_string = height	/ 2
    559	02B9  00 16 0005r				     add y_string, dl							    +
    560				     ;y_string += height / 2
    561
    562	02BD  C3					     ret								    +
    563				     ;return function value
    564	02BE						     endp								    +
    565				     ;proc's ending
    566
    567				     ;------------------------------------------------------------------------------
    568
    569				     ;------------------------------------------------------------------------------
    570				     ; Eval shift of frame inside string
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 11
border.asm



    571				     ; Entry:		     CX	= string length
    572				     ; Exit:		     None
    573				     ; Destroyed:    DI, BP, AX, BX
    574				     ;------------------------------------------------------------------------------
    575
    576	02BE			     EvalShift	     proc
    577
    578							     ;di = y_string * window_len * 2 + (x_start	+ (cx -	len) / 2) * 2
    579	02BE  A0 0005r					     mov al, y_string							    +
    580				     ;al = y_string
    581	02C1  D0 E0					     shl al, 1								    +
    582				     ;al *= 2
    583	02C3  32 E4					     xor ah, ah								    +
    584				     ;ah = 0
    585	02C5  BD 0050					     mov bp, window_len							    +
    586				     ;bp = 80
    587	02C8  52					     push dx								    +
    588				     ;save size	of frame in stack
    589	02C9  F7 E5					     mul bp								    +
    590				     ;ax = 2 * y_start * 80
    591	02CB  5A					     pop dx								    +
    592				     ;return size of frame from	stack to dx÷
    593	02CC  8B F8					     mov di, ax								    +
    594				     ;di = ax
    595
    596	02CE  32 E4					     xor ah, ah								    +
    597				     ;ah = 0
    598	02D0  32 FF					     xor bh, bh								    +
    599				     ;bh = 0
    600	02D2  A0 0003r					     mov al, x_start							    +
    601				     ;al = x_start
    602	02D5  BD 0000r					     mov bp, offset len							    +
    603				     ;bp = &len
    604	02D8  8A 1E 0000r				     mov bl, len							    +
    605				     ;bl = len
    606	02DC  2A D9					     sub bl, cl								    +
    607				     ;bl -= cl
    608	02DE  D0 EB					     shr bl, 1								    +
    609				     ;bl = (cx - len) /	2
    610	02E0  02 C3					     add al, bl								    +
    611				     ;x_start += (cx - len) / 2
    612	02E2  D0 E0					     shl al, 1								    +
    613				     ;al *= 2
    614	02E4  03 F8					     add di, ax								    +
    615				     ;di += al
    616
    617	02E6  D1 EF					     shr di, 1								    +
    618				     ;di /= 2
    619	02E8  D1 E7					     shl di, 1								    +
    620				     ;di *= 2
    621
    622	02EA  C3					     ret								    +
    623				     ;return function value
    624	02EB						     endp								    +
    625				     ;proc's ending
    626
    627				     ;------------------------------------------------------------------------------
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 12
border.asm



    628
    629
    630				     ;------------------------------------------------------------------------------
    631				     ; Eval string length with '$' terminal symbol
    632				     ; Entry:		     SI	= data string address
    633				     ; Exit:		     CX
    634				     ; Destroyed:    SI, AL, CX
    635				     ;------------------------------------------------------------------------------
    636
    637	02EB			     StrLen  proc
    638
    639	02EB					     str_len:									    +
    640				     ;<------------------------------|
    641	02EB  AC					     lodsb								    +
    642				     ;mov al, ds:[si]				     |
    643	02EC  3C 24					     cmp al, '$'							    +
    644				     ;if (al ==	'$') zf	= 1		     |
    645	02EE  74 05					     jz	end_str_len							    +
    646				     ;if (zf ==	1) goto	end_str_len  |
    647	02F0  83 C1 02					     add cx, 2								    +
    648				     ;cx += 2						     |
    649	02F3  E2 F6				     loop str_len								    +
    650				     ;-------------------------------|
    651	02F5					     end_str_len:								    +
    652				     ;label of str len ending
    653
    654	02F5  C3				     ret									    +
    655				     ;return function value
    656	02F6					     endp									    +
    657				     ;proc's ending
    658
    659				     ;------------------------------------------------------------------------------
    660
    661				     ;------------------------------------------------------------------------------
    662				     ; Print string inside the frame
    663				     ; Entry:		     BX	= data string address
    664				     ;				     AH	= string color
    665				     ;				     CX	= string length
    666				     ; Exit:		     None
    667				     ; Destroyed:    BX, AL, DI
    668				     ;------------------------------------------------------------------------------
    669
    670	02F6			     PrintInsideString	     proc
    671
    672	02F6								     print_string:					    +
    673				     ;<----------------------------------|
    674	02F6  AC								     lodsb					    +
    675				     ;mov al, ds:[si]					     |
    676	02F7  AB								     stosw					    +
    677				     ;mov es:[di], ax /	add di,	2	     |
    678	02F8  3C 24								     cmp al, '$'				    +
    679				     ;if (al ==	'$') zf	= 1			     |
    680	02FA  74 02								     jz	end_print_string			    +
    681				     ;if (zf ==	1) goto	end_print_string     |
    682	02FC  E2 F8							     loop print_string					    +
    683				     ;-----------------------------------|
    684	02FE								     end_print_string:					    +
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 13
border.asm



    685				     ;label of print string ending
    686
    687	02FE  C3							     ret						    +
    688				     ;return function value
    689	02FF								     endp						    +
    690				     ;proc's ending
    691
    692				     ;------------------------------------------------------------------------------
    693
    694				     ;------------------------------------------------------------------------------
    695				     ; Draw frame with size: len, height
    696				     ; Entry:		     SI	= data string address
    697				     ;				     DH	= frame	height
    698				     ;				     DL	= frame	len
    699				     ; Exit:		     None
    700				     ; Destroyed:    BX, CX, DI
    701				     ;------------------------------------------------------------------------------
    702
    703	02FF			     DrawFrame	     proc
    704
    705	02FF  A0 0004r					     mov al, y_start							    +
    706				     ;al = y_start
    707	0302  D0 E0					     shl al, 1								    +
    708				     ;al *= 2
    709	0304  BD 0050					     mov bp, window_len							    +
    710				     ;bp = 80
    711	0307  52					     push dx								    +
    712				     ;save size	of frame in stack
    713	0308  F7 E5					     mul bp								    +
    714				     ;ax = 2 * y_start * 80
    715	030A  5A					     pop dx								    +
    716				     ;return size of frame from	stack to dx
    717	030B  8B F8					     mov di, ax								    +
    718				     ;di = ax
    719	030D  A0 0003r					     mov al, x_start							    +
    720				     ;ax = x_start
    721	0310  D0 E0					     shl al, 1								    +
    722				     ;ax *= 2
    723	0312  32 E4					     xor ah, ah								    +
    724				     ;ah = 0
    725	0314  03 F8					     add di, ax								    +
    726				     ;di += 2 *	x_start
    727	0316  E8 001E					     call PrintString							    +
    728				     ;print string
    729
    730	0319  8A CE					     mov cl, dh								    +
    731				     ;loop on length of	frame string
    732	031B  32 ED					     xor ch, ch								    +
    733				     ;ch = 0
    734	031D  83 E9 02					     sub cx, 2								    +
    735				     ;without first and	lsat symbols of	string
    736	0320						     cycle1:								    +
    737				     ;<--------------------------|
    738	0320  81 C7 00A0					     add di, window_len	* 2					    +
    739				     ;di += window_len * 2	     |
    740	0324  E8 0010						     call PrintString						    +
    741				     ;print string			     |
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 14
border.asm



    742	0327  83 EE 03						     sub si, 3							    +
    743				     ;si -= 3					     |
    744	032A  E2 F4					     loop cycle1							    +
    745				     ;---------------------------|
    746	032C  83 C6 03					     add si, 3								    +
    747				     ;si += 3
    748
    749	032F  81 C7 00A0				     add di, window_len	* 2						    +
    750				     ;di += window_len * 2 (next line)
    751	0333  E8 0001					     call PrintString							    +
    752				     ;print string
    753
    754	0336  C3					     ret								    +
    755				     ;return function value
    756	0337						     endp								    +
    757				     ;proc's ending
    758
    759				     ;------------------------------------------------------------------------------
    760
    761				     ;------------------------------------------------------------------------------
    762				     ; Draws string to console in format: s1s2....s2s3
    763				     ; Entry:		     SI	= string address
    764				     ;				     DL	= string len
    765				     ; Exit:		     None
    766				     ; Destroyed:    AX, BX, CX, SI
    767				     ;------------------------------------------------------------------------------
    768
    769	0337			     PrintString     proc
    770
    771	0337  8A 26 0002r				     mov ah, frame_color						    +
    772				     ;set symbols color
    773
    774	033B  AC					     lodsb								    +
    775				     ;mov al, ds:[si]
    776	033C  AB					     stosw								    +
    777				     ;mov es:[di], ax /	add di,	2
    778
    779	033D  51					     push cx								    +
    780				     ;save prev	loop cnt
    781	033E  8A CA					     mov cl, dl								    +
    782				     ;counter =	dl
    783	0340  80 E9 02					     sub cl, 2								    +
    784				     ;without top and bottom line
    785	0343  8A 04					     mov al, [si]							    +
    786				     ;al = [si]
    787	0345						     cycle:								    +
    788				     ;<------------------------------|
    789	0345  AB						     stosw							    +
    790				     ;mov es:[di], ax /	add di,	2    |
    791	0346  E2 FD					     loop cycle								    +
    792				     ;-------------------------------|
    793	0348  46					     inc si								    +
    794				     ;bx++
    795	0349  59					     pop cx								    +
    796				     ;return prev loop cnt
    797
    798	034A  AC					     lodsb								    +
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 15
border.asm



    799				     ;mov al, ds:[si]
    800	034B  AB					     stosw								    +
    801				     ;mov es:[di], ax /	add di,	2
    802
    803	034C  8A DA					     mov bl, dl								    +
    804				     ;bl = dl
    805	034E  32 FF					     xor bh, bh								    +
    806				     ;bh = 0
    807	0350  D1 E3					     shl bx, 1								    +
    808				     ;bx *= 2
    809	0352  2B FB					     sub di, bx								    +
    810				     ;set di to	line beginning
    811
    812	0354  C3					     ret								    +
    813				     ;return function value
    814	0355						     endp								    +
    815				     ;proc's ending
    816
    817				     ;------------------------------------------------------------------------------
    818
    819	0355			     .data
    820	0000  46		     len			     db	70							    +
    821				     ;frame row	length
    822	0001  0D		     height			     db	13							    +
    823				     ;frame column height
    824	0002  4E		     frame_color	     db	4eh								    +
    825				     ;frame element color
    826
    827	0003  00		     x_start			     db	0							    +
    828				     ;x	frame start position
    829	0004  00		     y_start			     db	0							    +
    830				     ;y	frame start position
    831	0005  05		     y_string			     db	5							    +
    832				     ;y	string start position
    833	0006  00		     str_data_pos	     db	0								    +
    834				     ;cmd line position	of string
    835
    836	0007  01		     frame_style	     db	1								    +
    837				     ;frame style
    838	0008  C9 CD BB BA 20 BA	C8+  DoubleFrameString	     db	'ÉÍ»º ºÈÍ¼'
    839	      CD BC
    840	0011  DA C4 BF B3 20 B3	C0+  SingleFrameString	     db	'ÚÄ¿³ ³ÀÄÙ'
    841	      C4 D9
    842	001A  03 03 03 03 20 03	03+  HeartFrameString	     db	' '
    843	      03 03
    844	0023  31 32 33 34 35 36	37+  DebugFrameString	     db	'123456789'
    845	      38 39
    846	002C  FB FB FB FB 20 FB	FB+  MathFrameString	     db	'ûûûû ûûûû'
    847	      FB FB
    848	0035  52 54 52 54 20 54	52+  PatriotFrameString	     db	'RTRT TRTR'
    849	      54 52
    850	003E  B2 B1 B2 B0 20 B0	B2+  PointedFrameString	     db	'²±²° °²±²'
    851	      B1 B2
    852	0047  C0 C1 D9 B4 20 C3	BF+  OutsideFrameString	     db	'ÀÁÙ´ Ã¿ÂÚ'
    853	      C2 DA
    854	0050  53 61 69 6E 74 20	56+  InsideString	     db	"Saint Valentine's Day!$"
    855	      61 6C 65 6E 74 69	6E+
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 16
border.asm



    856	      65 27 73 20 44 61	79+
    857	      21 24
    858
    859	0067			     EOP:
    860				     end     Start										    +
    861				     ;prog's ending
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 17
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/24/25"
??FILENAME			  Text	 "border  "
??TIME				  Text	 "00:43:27"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _DATA
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 BORDER
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ATOH				  Near	 DGROUP:0234
ATOI				  Near	 DGROUP:025F
BOTH				  Near	 DGROUP:0256
CALCPARAM			  Near	 DGROUP:0292
CMD_LINE_ADD			  Number 0081
CMD_SKIP_QUOT			  Near	 DGROUP:01DC
CMD_SKIP_SPC			  Near	 DGROUP:0287
CYCLE				  Near	 DGROUP:0345
CYCLE1				  Near	 DGROUP:0320
DEBUGFRAMESTRING		  Byte	 DGROUP:0023
DOUBLEFRAMESTRING		  Byte	 DGROUP:0008
DRAWFRAME			  Near	 DGROUP:02FF
DRAWSTRING			  Near	 DGROUP:01E7
END_ATOH			  Near	 DGROUP:025E
END_ATOI			  Near	 DGROUP:0283
END_CMD_SKIP_QUOT		  Near	 DGROUP:01E6
END_CMD_SKIP_SPC		  Near	 DGROUP:0291
END_PRINT_STRING		  Near	 DGROUP:02FE
END_STR_LEN			  Near	 DGROUP:02F5
ENTERDATA			  Near	 DGROUP:0203
EOP				  Near	 DGROUP:0067
EVALSHIFT			  Near	 DGROUP:02BE
FRAME_COLOR			  Byte	 DGROUP:0002
FRAME_STYLE			  Byte	 DGROUP:0007
GET_HEX				  Near	 DGROUP:023D
GET_SYMBOL			  Near	 DGROUP:0268
HEARTFRAMESTRING		  Byte	 DGROUP:001A
HEIGHT				  Byte	 DGROUP:0001
INSIDESTRING			  Byte	 DGROUP:0050
LEN				  Byte	 DGROUP:0000
MAINBORDER			  Near	 DGROUP:0170
MATHFRAMESTRING			  Byte	 DGROUP:002C
NEW09H				  Near	 DGROUP:0130
NO_SIGN				  Near	 DGROUP:0253
OLD09OFS			  Word	 DGROUP:016C
OLD09SEG			  Word	 DGROUP:016E
OUTSIDEFRAMESTRING		  Byte	 DGROUP:0047
OWN_STYLE			  Near	 DGROUP:01C4
Turbo Assembler	 Version 4.1	    02/24/25 00:43:27	    Page 18
Symbol Table



PATRIOTFRAMESTRING		  Byte	 DGROUP:0035
POINTEDFRAMESTRING		  Byte	 DGROUP:003E
PRINTINSIDESTRING		  Near	 DGROUP:02F6
PRINTSTRING			  Near	 DGROUP:0337
PRINT_STRING			  Near	 DGROUP:02F6
SETSTYLE			  Near	 DGROUP:0197
SINGLEFRAMESTRING		  Byte	 DGROUP:0011
SKIP				  Near	 DGROUP:0154
SKIPQUOT			  Near	 DGROUP:01D9
SKIPSPACES			  Near	 DGROUP:0284
START				  Near	 DGROUP:0100
STRLEN				  Near	 DGROUP:02EB
STR_DATA_POS			  Byte	 DGROUP:0006
STR_LEN				  Near	 DGROUP:02EB
VIDEO_SEGMENT			  Number B800
WINDOW_HEIGHT			  Number 0019
WINDOW_LEN			  Number 0050
X_START				  Byte	 DGROUP:0003
Y_START				  Byte	 DGROUP:0004
Y_STRING			  Byte	 DGROUP:0005

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0067 Word	  Public  DATA
  _TEXT				  16  0355 Word	  Public  CODE
