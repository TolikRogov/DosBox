Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 1
resident.asm



      1				     ;------------------------------------------------------------------------------
      2				     ;			      Card for Saint Valentine's Day (aka frame)
      3				     ;			     @Rogov Anatoliy 08.02.2025	"Sivchuk Bad Day"
      4				     ;------------------------------------------------------------------------------
      5
      6	      =0081		     cmd_line_add	     = 0081h								    +
      7				     ;cmd line address
      8	      =B800		     video_segment	     = 0b800h								    +
      9				     ;video segment
     10	      =0050		     window_len			     = 80							    +
     11				     ;window row length
     12	      =0019		     window_height	     = 25								    +
     13				     ;window column height
     14	      =0004		     reg_in_frame	     = 4								    +
     15				     ;amount of	registers in frame
     16
     17	0000			     .model tiny										    +
     18				     ;set 64 Kb	model
     19	0000			     .code											    +
     20				     ;define code block
     21				     org 100h											    +
     22				     ;prog's beginning ram block
     23
     24	0100  33 C0		     Start:  xor ax, ax										    +
     25				     ;ax = 0
     26	0102  8E C0				     mov es, ax									    +
     27				     ;es = 0
     28	0104  BB 0024				     mov bx, 09h * 4								    +
     29				     ;bx = &int	09h
     30
     31	0107  26: 8B 07				     mov ax, es:[bx]								    +
     32				     ;ax = old09h offset
     33	010A  A3 016Cr				     mov old09ofs, ax								    +
     34				     ;old09fs =	ax
     35	010D  26: 8B 47	02			     mov ax, es:[bx + 2]							    +
     36				     ;ax = old09h segment
     37	0111  A3 016Er				     mov old09seg, ax								    +
     38				     ;old09seg = ax
     39
     40	0114  26: C7 07	0130r			     mov es:[bx], offset New09h							    +
     41				     ;change 09h interrupt function by mine
     42	0119  8C C8				     mov ax, cs									    +
     43				     ;ax = cs
     44	011B  26: 89 47	02			     mov es:[bx	+ 2], ax							    +
     45				     ;current segment
     46
     47	011F  B8 3100				     mov ax, 3100h								    +
     48				     ;make program resident
     49	0122  BA 0030r				     mov dx, offset EOP								    +
     50				     ;dx = &EOP
     51	0125  D1 EA D1 EA D1 EA	D1+		     shr dx, 4									    +
     52	      EA		     ;dx /= 4
     53	012D  42				     inc dx									    +
     54				     ;dx += 1
     55	012E  CD 21				     int 21h									    +
     56				     ;31 function of 21	interrupt
     57
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 2
resident.asm



     58				     ;------------------------------------------------------------------------------
     59				     ; New procedural handler of 09h interrupt
     60				     ; Entry:		     NONE
     61				     ; Exit:		     NONE
     62				     ; Destroyed:    NONE
     63				     ;------------------------------------------------------------------------------
     64
     65	0130			     New09h  proc
     66	0130  50 53 51 52 06 56	55		     push ax bx	cx dx es si bp							    +
     67				     ;save all registers
     68
     69	0137  E4 60				     in	al, 60h									    +
     70				     ;al = scan	code from 60h port
     71	0139  3C 58				     cmp al, 58h								    +
     72				     ;if (al ==	F12) zf	= 1
     73	013B  75 17				     jne skip									    +
     74				     ;if (zf !=	1) goto	skip --------|
     75	013D  50 53 51 52 06 56	55+			     push ax bx	cx dx es si bp ds				     ;save  +
     76	      1E		     all registers			       |
     77																    +
     78				     ;								     |
     79	0145  8C CB					     mov bx, cs								    +
     80				     ;bx = code	segment				     |
     81	0147  8E DB					     mov ds, bx								    +
     82				     ;data segment = code segment    |
     83	0149  E8 0024					     call MainBorder							    +
     84				     ;Main Border function		     |
     85																    +
     86				     ;								     |
     87	014C  1F 5D 5E 07 5A 59	5B+			     pop ds bp si es dx	cx bx ax					    +
     88	      58		     ;return all registers		     |
     89	0154					     skip:									    +
     90				     ;<------------------------------|
     91
     92						     ;say that ready to	input new button by blink the bit
     93	0154  E4 61				     in	al, 61h									    +
     94				     ;al = value from 61h keyboard port
     95	0156  8A E0				     mov ah, al									    +
     96				     ;ah = al
     97	0158  0C 80				     or	al, 80h									    +
     98				     ;set the highest bit
     99	015A  E6 61				     out 61h, al								    +
    100				     ;out al to	61h keyboard port
    101	015C  8A C4				     mov al, ah									    +
    102				     ;al = ah
    103	015E  E6 61				     out 61h, al								    +
    104				     ;out al to	61h keyboard port
    105
    106	0160  B0 20				     mov al, 20h								    +
    107				     ;non-specific end of interrupt
    108	0162  E6 20				     out 20h, al								    +
    109				     ;interrupt	controller port
    110
    111	0164  5D 5E 07 5A 59 5B	58		     pop bp si es dx cx	bx ax							    +
    112				     ;return all registers after interrupt
    113	016B  EA					     db	0eah								    +
    114				     ;jump to old procedural handler of	09h interrupt
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 3
resident.asm



    115	016C  0000		     old09ofs	     dw	0									    +
    116				     ;previous offset
    117	016E  0000		     old09seg	     dw	0									    +
    118				     ;in segment
    119	0170					     endp
    120
    121				     ;------------------------------------------------------------------------------
    122
    123				     ;------------------------------------------------------------------------------
    124				     ; Main Border
    125				     ; Entry:		     None
    126				     ; Exit:		     SI
    127				     ; Destroyed:    SI, BP, BX, DX
    128				     ;------------------------------------------------------------------------------
    129
    130	0170			     MainBorder	     proc
    131
    132	0170  33 C0					     xor ax, ax								    +
    133				     ;ax = 0
    134	0172  33 DB					     xor bx, bx								    +
    135				     ;bx = 0
    136	0174  33 C9					     xor cx, cx								    +
    137				     ;cx = 0
    138	0176  33 D2					     xor dx, dx								    +
    139				     ;dx = 0
    140
    141	0178  BB B800					     mov bx, video_segment						    +
    142				     ;bx = video segment position
    143	017B  8E C3					     mov es, bx								    +
    144				     ;es = bx
    145
    146	017D  E8 00A4					     call CalcParam							    +
    147				     ;x_start, y_start,	y_string
    148	0180  E8 0011					     call SetStyle							    +
    149				     ;calculate	si
    150
    151	0183  8A 36 0001r				     mov dh, height							    +
    152				     ;dh = height
    153	0187  8A 16 0000r				     mov dl, len							    +
    154				     ;dl = len
    155	018B  33 FF					     xor di, di								    +
    156				     ;di = 0;
    157	018D  E8 00F3					     call DrawFrame							    +
    158				     ;Drawing frame
    159	0190  E8 0010					     call DrawString							    +
    160				     ;Drawing string inside frame
    161
    162	0193  C3					     ret								    +
    163				     ;return function value
    164	0194						     endp								    +
    165				     ;proc's ending
    166
    167				     ;------------------------------------------------------------------------------
    168
    169				     ;------------------------------------------------------------------------------
    170				     ; Set frame style
    171				     ; Entry:		     None
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 4
resident.asm



    172				     ; Exit:		     SI
    173				     ; Destroyed:    SI, BP, BX, DX
    174				     ;------------------------------------------------------------------------------
    175
    176	0194			     SetStyle	     proc
    177
    178	0194  33 D2					     xor dx, dx								    +
    179				     ;dx = 0
    180	0196  BA 0010r					     mov dx, offset AXString						    +
    181				     ;dx = &AXString
    182	0199  BD 0006r					     mov bp, offset str_data_pos					    +
    183				     ;bp = &str_data_pos
    184	019C  89 56 00					     mov [bp], dx							    +
    185				     ;str_data_pos = AXString
    186
    187	019F  BE 0007r					     mov si, offset DoubleFrameString				     ;si =  +
    188				     &style string
    189
    190	01A2  C3					     ret								    +
    191				     ;return function value
    192	01A3						     endp								    +
    193				     ;proc's ending
    194
    195				     ;------------------------------------------------------------------------------
    196
    197				     ;------------------------------------------------------------------------------
    198				     ; Draw string inside the frame
    199				     ; Entry:		     None
    200				     ; Exit:		     None
    201				     ; Destroyed:    SI, BP, CX, AH
    202				     ;------------------------------------------------------------------------------
    203
    204	01A3			     DrawString	     proc
    205
    206	01A3  B9 0004					     mov cx, reg_in_frame						    +
    207				     ;cx = amount of registers
    208	01A6						     reg_str:								    +
    209				     ;<--------------------------------------------------------------|
    210	01A6  51						     push cx							    +
    211				     ;save cx											    +
    212				     |
    213	01A7  BD 0006r						     mov bp, offset str_data_pos				    +
    214				     ;bp = &str_data_pos									    +
    215				     |
    216	01AA  8B 76 00						     mov si, [bp]						    +
    217				     ;si = str_data_pos										    +
    218				     |
    219	01AD  33 C9						     xor cx, cx							    +
    220				     ;cx = 0											    +
    221				     |
    222	01AF  E8 00BD						     call StrLen						    +
    223				     ;cx = len(si)										    +
    224				     |
    225	01B2  51						     push cx							    +
    226				     ;save len											    +
    227				     |
    228																    +
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 5
resident.asm



    229				     ;												    +
    230				     |
    231	01B3  BD 0006r						     mov bp, offset str_data_pos				    +
    232				     ;bp = &str_data_pos									    +
    233				     |
    234	01B6  8B 76 00						     mov si, [bp]						    +
    235				     ;si = &inside frame string									    +
    236				     |
    237	01B9  E8 0086						     call EvalShift						    +
    238				     ;di = 2 * window_len * y_start + (x_start + (cx - len) / 2) * 2 |
    239																    +
    240				     ;												    +
    241				     |
    242	01BC  8A 26 0002r					     mov ah, frame_color					    +
    243				     ;ah = string color										    +
    244				     |
    245	01C0  E8 00B7						     call PrintInsideString					    +
    246				     ;print string										    +
    247				     |
    248																    +
    249				     ;												    +
    250				     |
    251	01C3  59						     pop cx							    +
    252				     ;return len										    +
    253				     |
    254	01C4  BD 0006r						     mov bp, offset str_data_pos				    +
    255				     ;bp = &str_data_pos									    +
    256				     |
    257	01C7  41						     inc cx							    +
    258				     ;cx += 1											    +
    259				     |
    260	01C8  01 4E 00						     add [bp], cx						    +
    261				     ;str_data_pos = len + 1									    +
    262				     |
    263	01CB  80 06 0005r 01					     add y_string, 1						    +
    264				     ;y_string += 1										    +
    265				     |
    266	01D0  59						     pop cx							    +
    267				     ;return loop counter									    +
    268				     |
    269	01D1  E2 D3					     loop reg_str							    +
    270				     ;---------------------------------------------------------------|
    271
    272	01D3  C3					     ret								    +
    273				     ;return function value
    274	01D4						     endp								    +
    275				     ;proc's ending
    276
    277				     ;------------------------------------------------------------------------------
    278
    279				     ;------------------------------------------------------------------------------
    280				     ; ASCII code symbols to hex integer (ABCDEF instead of abcdef)
    281				     ; Entry:		     AL	- first	symbol
    282				     ; Exit:		     BL	- hex
    283				     ; Destroyed:    CX, BX, DX, AX
    284				     ;------------------------------------------------------------------------------
    285
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 6
resident.asm



    286	01D4			     Atoh    proc
    287
    288	01D4  B9 0001				     mov cx, 1									    +
    289				     ;cx = 1
    290	01D7  33 DB				     xor bx, bx									    +
    291				     ;bx = 0
    292	01D9  33 D2				     xor dx, dx									    +
    293				     ;dx = 0
    294	01DB  32 E4				     xor ah, ah									    +
    295				     ;ah = 0
    296
    297	01DD					     get_hex:									    +
    298				     ;<--------------------------|
    299	01DD  3C 20					     cmp al, ' '							    +
    300				     ;if (al ==	' ') zf	= 1	     |
    301	01DF  74 1D					     je	end_atoh							    +
    302				     ;if (zf ==	1) goto	end_atoi     |
    303																    +
    304				     ;							     |
    305	01E1  D1 E3 D1 E3 D1 E3	D1+			     shl bx, 4								    +
    306	      E3		     ;bx *= 16					     |
    307																    +
    308				     ;							     |
    309	01E9  3C 41					     cmp al, 'A'							    +
    310				     ;if (al - 65 < 0) fs = 1	     |
    311	01EB  79 06					     jns no_sign							    +
    312				     ;if (fs !=	1) goto	no_sign	     |
    313	01ED  2D 0030					     sub ax, '0'							    +
    314				     ;ax -= 48					     |
    315	01F0  EB 04 90					     jmp both								    +
    316				     ;goto both					     |
    317	01F3						     no_sign:								    +
    318				     ;							     |
    319	01F3  2D 0037						     sub ax, 55							    +
    320				     ;ax -= 55					     |
    321	01F6						     both:								    +
    322				     ;							     |
    323	01F6  03 D8					     add bx, ax								    +
    324				     ;bx += ax					     |
    325																    +
    326				     ;							     |
    327	01F8  83 C1 02					     add cx, 2								    +
    328				     ;cx += 2					     |
    329	01FB  AC					     lodsb								    +
    330				     ;mov al, ds:[si]			     |
    331	01FC  E2 DF				     loop get_hex								    +
    332				     ;---------------------------|
    333	01FE					     end_atoh:
    334
    335	01FE  C3				     ret									    +
    336				     ;return function value
    337	01FF					     endp									    +
    338				     ;proc's ending
    339
    340				     ;------------------------------------------------------------------------------
    341
    342				     ;------------------------------------------------------------------------------
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 7
resident.asm



    343				     ; ASCII code symbols to integer
    344				     ; Entry:		     AL	- first	symbol
    345				     ; Exit:		     BL	- integer
    346				     ; Destroyed:    CX, BX, DX, AX
    347				     ;------------------------------------------------------------------------------
    348
    349	01FF			     Atoi    proc
    350
    351	01FF  B9 0001				     mov cx, 1									    +
    352				     ;cx = 1
    353	0202  33 DB				     xor bx, bx									    +
    354				     ;bx = 0
    355	0204  33 D2				     xor dx, dx									    +
    356				     ;dx = 0
    357	0206  32 E4				     xor ah, ah									    +
    358				     ;ah = 0
    359
    360	0208					     get_symbol:								    +
    361				     ;<--------------------------|
    362	0208  3C 20					     cmp al, ' '							    +
    363				     ;if (al ==	' ') zf	= 1	     |
    364	020A  74 17					     je	end_atoi							    +
    365				     ;if (zf ==	1) goto	end_atoi     |
    366																    +
    367				     ;							     |
    368	020C  53					     push bx								    +
    369				     ;save bx					     |
    370	020D  D1 E3 D1 E3 D1 E3				     shl bx, 3								    +
    371				     ;bx *= 8					     |
    372																    +
    373				     ;							     |
    374	0213  5A					     pop dx								    +
    375				     ;return bx: dx = bx		     |
    376	0214  D1 E2					     shl dx, 1								    +
    377				     ;dx *= 2					     |
    378	0216  03 DA					     add bx, dx								    +
    379				     ;bx += dx					     |
    380																    +
    381				     ;							     |
    382	0218  2D 0030					     sub ax, 48								    +
    383				     ;ax -= 48					     |
    384	021B  03 D8					     add bx, ax								    +
    385				     ;bx += ax					     |
    386																    +
    387				     ;							     |
    388	021D  83 C1 02					     add cx, 2								    +
    389				     ;cx += 2					     |
    390	0220  AC					     lodsb								    +
    391				     ;mov al, ds:[si]			     |
    392	0221  E2 E5				     loop get_symbol								    +
    393				     ;---------------------------|
    394	0223					     end_atoi:
    395
    396	0223  C3				     ret									    +
    397				     ;return function value
    398	0224					     endp									    +
    399				     ;proc's ending
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 8
resident.asm



    400
    401				     ;------------------------------------------------------------------------------
    402
    403				     ;------------------------------------------------------------------------------
    404				     ; Calculate values	of variables: x_start, y_start,	y_string
    405				     ; Entry:		     None
    406				     ; Exit:		     None
    407				     ; Destroyed:    AX, BX, DX, BP
    408				     ;------------------------------------------------------------------------------
    409
    410	0224			     CalcParam	     proc
    411
    412							     ;x_start =	window_len - len
    413	0224  A0 0000r					     mov al, len							    +
    414				     ;al = len
    415	0227  B3 50					     mov bl, window_len							    +
    416				     ;bp = 80
    417	0229  88 1E 0003r				     mov x_start, bl							    +
    418				     ;x_start =	80
    419	022D  28 06 0003r				     sub x_start, al							    +
    420				     ;x_start -= len
    421
    422	0231  C6 06 0004r 02 90				     mov y_start, 2							    +
    423				     ;y_start =	1
    424
    425	0237  8A 1E 0004r				     mov bl, y_start							    +
    426				     ;bp = y_start
    427	023B  FE C3					     inc bl								    +
    428				     ;bl += 1
    429	023D  88 1E 0005r				     mov y_string, bl							    +
    430				     ;y_string = y_start + 1
    431
    432	0241  C3					     ret								    +
    433				     ;return function value
    434	0242						     endp								    +
    435				     ;proc's ending
    436
    437				     ;------------------------------------------------------------------------------
    438
    439				     ;------------------------------------------------------------------------------
    440				     ; Eval shift of frame inside string
    441				     ; Entry:		     CX	= string length
    442				     ; Exit:		     None
    443				     ; Destroyed:    DI, BP, AX, BX
    444				     ;------------------------------------------------------------------------------
    445
    446	0242			     EvalShift	     proc
    447
    448							     ;di = y_string * window_len * 2 + (x_start	+ (cx -	len) / 2) * 2
    449	0242  A0 0005r					     mov al, y_string							    +
    450				     ;al = y_string
    451	0245  D0 E0					     shl al, 1								    +
    452				     ;al *= 2
    453	0247  32 E4					     xor ah, ah								    +
    454				     ;ah = 0
    455	0249  BD 0050					     mov bp, window_len							    +
    456				     ;bp = 80
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 9
resident.asm



    457	024C  52					     push dx								    +
    458				     ;save size	of frame in stack
    459	024D  F7 E5					     mul bp								    +
    460				     ;ax = 2 * y_start * 80
    461	024F  5A					     pop dx								    +
    462				     ;return size of frame from	stack to dxâ‰ˆ
    463	0250  8B F8					     mov di, ax								    +
    464				     ;di = ax
    465
    466	0252  32 E4					     xor ah, ah								    +
    467				     ;ah = 0
    468	0254  32 FF					     xor bh, bh								    +
    469				     ;bh = 0
    470	0256  A0 0003r					     mov al, x_start							    +
    471				     ;al = x_start
    472	0259  BD 0000r					     mov bp, offset len							    +
    473				     ;bp = &len
    474	025C  8A 1E 0000r				     mov bl, len							    +
    475				     ;bl = len
    476	0260  2A D9					     sub bl, cl								    +
    477				     ;bl -= cl
    478	0262  D0 EB					     shr bl, 1								    +
    479				     ;bl = (cx - len) /	2
    480	0264  02 C3					     add al, bl								    +
    481				     ;x_start += (cx - len) / 2
    482	0266  D0 E0					     shl al, 1								    +
    483				     ;al *= 2
    484	0268  03 F8					     add di, ax								    +
    485				     ;di += al
    486
    487	026A  D1 EF					     shr di, 1								    +
    488				     ;di /= 2
    489	026C  D1 E7					     shl di, 1								    +
    490				     ;di *= 2
    491
    492	026E  C3					     ret								    +
    493				     ;return function value
    494	026F						     endp								    +
    495				     ;proc's ending
    496
    497				     ;------------------------------------------------------------------------------
    498
    499
    500				     ;------------------------------------------------------------------------------
    501				     ; Eval string length with '$' terminal symbol
    502				     ; Entry:		     SI	= data string address
    503				     ; Exit:		     CX
    504				     ; Destroyed:    SI, AL, CX
    505				     ;------------------------------------------------------------------------------
    506
    507	026F			     StrLen  proc
    508
    509	026F					     str_len:									    +
    510				     ;<------------------------------|
    511	026F  AC					     lodsb								    +
    512				     ;mov al, ds:[si]				     |
    513	0270  3C 24					     cmp al, '$'							    +
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 10
resident.asm



    514				     ;if (al ==	'$') zf	= 1		     |
    515	0272  74 05					     jz	end_str_len							    +
    516				     ;if (zf ==	1) goto	end_str_len  |
    517	0274  83 C1 02					     add cx, 2								    +
    518				     ;cx += 2						     |
    519	0277  E2 F6				     loop str_len								    +
    520				     ;-------------------------------|
    521	0279					     end_str_len:								    +
    522				     ;label of str len ending
    523
    524	0279  C3				     ret									    +
    525				     ;return function value
    526	027A					     endp									    +
    527				     ;proc's ending
    528
    529				     ;------------------------------------------------------------------------------
    530
    531				     ;------------------------------------------------------------------------------
    532				     ; Print string inside the frame
    533				     ; Entry:		     BX	= data string address
    534				     ;				     AH	= string color
    535				     ;				     CX	= string length
    536				     ; Exit:		     None
    537				     ; Destroyed:    BX, AL, DI
    538				     ;------------------------------------------------------------------------------
    539
    540	027A			     PrintInsideString	     proc
    541
    542	027A								     print_string:					    +
    543				     ;<----------------------------------|
    544	027A  AC								     lodsb					    +
    545				     ;mov al, ds:[si]					     |
    546	027B  AB								     stosw					    +
    547				     ;mov es:[di], ax /	add di,	2	     |
    548	027C  3C 24								     cmp al, '$'				    +
    549				     ;if (al ==	'$') zf	= 1			     |
    550	027E  74 02								     jz	end_print_string			    +
    551				     ;if (zf ==	1) goto	end_print_string     |
    552	0280  E2 F8							     loop print_string					    +
    553				     ;-----------------------------------|
    554	0282								     end_print_string:					    +
    555				     ;label of print string ending
    556
    557	0282  C3							     ret						    +
    558				     ;return function value
    559	0283								     endp						    +
    560				     ;proc's ending
    561
    562				     ;------------------------------------------------------------------------------
    563
    564				     ;------------------------------------------------------------------------------
    565				     ; Draw frame with size: len, height
    566				     ; Entry:		     SI	= data string address
    567				     ;				     DH	= frame	height
    568				     ;				     DL	= frame	len
    569				     ; Exit:		     None
    570				     ; Destroyed:    BX, CX, DI
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 11
resident.asm



    571				     ;------------------------------------------------------------------------------
    572
    573	0283			     DrawFrame	     proc
    574
    575	0283  A0 0004r					     mov al, y_start							    +
    576				     ;al = y_start
    577	0286  D0 E0					     shl al, 1								    +
    578				     ;al *= 2
    579	0288  BD 0050					     mov bp, window_len							    +
    580				     ;bp = 80
    581	028B  52					     push dx								    +
    582				     ;save size	of frame in stack
    583	028C  F7 E5					     mul bp								    +
    584				     ;ax = 2 * y_start * 80
    585	028E  5A					     pop dx								    +
    586				     ;return size of frame from	stack to dx
    587	028F  8B F8					     mov di, ax								    +
    588				     ;di = ax
    589	0291  A0 0003r					     mov al, x_start							    +
    590				     ;ax = x_start
    591	0294  D0 E0					     shl al, 1								    +
    592				     ;ax *= 2
    593	0296  32 E4					     xor ah, ah								    +
    594				     ;ah = 0
    595	0298  03 F8					     add di, ax								    +
    596				     ;di += 2 *	x_start
    597	029A  E8 001E					     call PrintString							    +
    598				     ;print string
    599
    600	029D  8A CE					     mov cl, dh								    +
    601				     ;loop on length of	frame string
    602	029F  32 ED					     xor ch, ch								    +
    603				     ;ch = 0
    604	02A1  83 E9 02					     sub cx, 2								    +
    605				     ;without first and	lsat symbols of	string
    606	02A4						     cycle1:								    +
    607				     ;<--------------------------|
    608	02A4  81 C7 00A0					     add di, window_len	* 2					    +
    609				     ;di += window_len * 2	     |
    610	02A8  E8 0010						     call PrintString						    +
    611				     ;print string			     |
    612	02AB  83 EE 03						     sub si, 3							    +
    613				     ;si -= 3					     |
    614	02AE  E2 F4					     loop cycle1							    +
    615				     ;---------------------------|
    616	02B0  83 C6 03					     add si, 3								    +
    617				     ;si += 3
    618
    619	02B3  81 C7 00A0				     add di, window_len	* 2						    +
    620				     ;di += window_len * 2 (next line)
    621	02B7  E8 0001					     call PrintString							    +
    622				     ;print string
    623
    624	02BA  C3					     ret								    +
    625				     ;return function value
    626	02BB						     endp								    +
    627				     ;proc's ending
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 12
resident.asm



    628
    629				     ;------------------------------------------------------------------------------
    630
    631				     ;------------------------------------------------------------------------------
    632				     ; Draws string to console in format: s1s2....s2s3
    633				     ; Entry:		     SI	= string address
    634				     ;				     DL	= string len
    635				     ; Exit:		     None
    636				     ; Destroyed:    AX, BX, CX, SI
    637				     ;------------------------------------------------------------------------------
    638
    639	02BB			     PrintString     proc
    640
    641	02BB  8A 26 0002r				     mov ah, frame_color						    +
    642				     ;set symbols color
    643
    644	02BF  AC					     lodsb								    +
    645				     ;mov al, ds:[si]
    646	02C0  AB					     stosw								    +
    647				     ;mov es:[di], ax /	add di,	2
    648
    649	02C1  51					     push cx								    +
    650				     ;save prev	loop cnt
    651	02C2  8A CA					     mov cl, dl								    +
    652				     ;counter =	dl
    653	02C4  80 E9 02					     sub cl, 2								    +
    654				     ;without top and bottom line
    655	02C7  8A 04					     mov al, [si]							    +
    656				     ;al = [si]
    657	02C9						     cycle:								    +
    658				     ;<------------------------------|
    659	02C9  AB						     stosw							    +
    660				     ;mov es:[di], ax /	add di,	2    |
    661	02CA  E2 FD					     loop cycle								    +
    662				     ;-------------------------------|
    663	02CC  46					     inc si								    +
    664				     ;bx++
    665	02CD  59					     pop cx								    +
    666				     ;return prev loop cnt
    667
    668	02CE  AC					     lodsb								    +
    669				     ;mov al, ds:[si]
    670	02CF  AB					     stosw								    +
    671				     ;mov es:[di], ax /	add di,	2
    672
    673	02D0  8A DA					     mov bl, dl								    +
    674				     ;bl = dl
    675	02D2  32 FF					     xor bh, bh								    +
    676				     ;bh = 0
    677	02D4  D1 E3					     shl bx, 1								    +
    678				     ;bx *= 2
    679	02D6  2B FB					     sub di, bx								    +
    680				     ;set di to	line beginning
    681
    682	02D8  C3					     ret								    +
    683				     ;return function value
    684	02D9						     endp								    +
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 13
resident.asm



    685				     ;proc's ending
    686
    687				     ;------------------------------------------------------------------------------
    688
    689	02D9			     .data
    690	0000  13		     len			     db	19							    +
    691				     ;frame row	length
    692	0001  07		     height			     db	7							    +
    693				     ;frame column height
    694	0002  4E		     frame_color	     db	4eh								    +
    695				     ;frame element color
    696
    697	0003  00		     x_start			     db	0							    +
    698				     ;x	frame start position
    699	0004  00		     y_start			     db	0							    +
    700				     ;y	frame start position
    701	0005  00		     y_string			     db	0							    +
    702				     ;y	string start position
    703	0006  00		     str_data_pos	     db	0								    +
    704				     ;cmd line position	of string
    705
    706	0007  C9 CD BB BA 20 BA	C8+  DoubleFrameString	     db	'ÉÍ»º ºÈÍ¼'
    707	      CD BC
    708	0010  61 78 20 30 30 30	30+  AXString			     db	"ax 0000$"
    709	      24
    710	0018  62 78 20 30 30 30	30+  BXString			     db	"bx 0000$"
    711	      24
    712	0020  63 78 20 30 30 30	30+  CXString			     db	"cx 0000$"
    713	      24
    714	0028  64 78 20 30 30 30	30+  DXString			     db	"dx 0000$"
    715	      24
    716
    717	0030			     EOP:
    718				     end     Start										    +
    719				     ;prog's ending
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 14
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/24/25"
??FILENAME			  Text	 "resident"
??TIME				  Text	 "02:49:49"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _DATA
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 RESIDENT
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ATOH				  Near	 DGROUP:01D4
ATOI				  Near	 DGROUP:01FF
AXSTRING			  Byte	 DGROUP:0010
BOTH				  Near	 DGROUP:01F6
BXSTRING			  Byte	 DGROUP:0018
CALCPARAM			  Near	 DGROUP:0224
CMD_LINE_ADD			  Number 0081
CXSTRING			  Byte	 DGROUP:0020
CYCLE				  Near	 DGROUP:02C9
CYCLE1				  Near	 DGROUP:02A4
DOUBLEFRAMESTRING		  Byte	 DGROUP:0007
DRAWFRAME			  Near	 DGROUP:0283
DRAWSTRING			  Near	 DGROUP:01A3
DXSTRING			  Byte	 DGROUP:0028
END_ATOH			  Near	 DGROUP:01FE
END_ATOI			  Near	 DGROUP:0223
END_PRINT_STRING		  Near	 DGROUP:0282
END_STR_LEN			  Near	 DGROUP:0279
EOP				  Near	 DGROUP:0030
EVALSHIFT			  Near	 DGROUP:0242
FRAME_COLOR			  Byte	 DGROUP:0002
GET_HEX				  Near	 DGROUP:01DD
GET_SYMBOL			  Near	 DGROUP:0208
HEIGHT				  Byte	 DGROUP:0001
LEN				  Byte	 DGROUP:0000
MAINBORDER			  Near	 DGROUP:0170
NEW09H				  Near	 DGROUP:0130
NO_SIGN				  Near	 DGROUP:01F3
OLD09OFS			  Word	 DGROUP:016C
OLD09SEG			  Word	 DGROUP:016E
PRINTINSIDESTRING		  Near	 DGROUP:027A
PRINTSTRING			  Near	 DGROUP:02BB
PRINT_STRING			  Near	 DGROUP:027A
REG_IN_FRAME			  Number 0004
REG_STR				  Near	 DGROUP:01A6
SETSTYLE			  Near	 DGROUP:0194
SKIP				  Near	 DGROUP:0154
START				  Near	 DGROUP:0100
Turbo Assembler	 Version 4.1	    02/24/25 02:49:50	    Page 15
Symbol Table



STRLEN				  Near	 DGROUP:026F
STR_DATA_POS			  Byte	 DGROUP:0006
STR_LEN				  Near	 DGROUP:026F
VIDEO_SEGMENT			  Number B800
WINDOW_HEIGHT			  Number 0019
WINDOW_LEN			  Number 0050
X_START				  Byte	 DGROUP:0003
Y_START				  Byte	 DGROUP:0004
Y_STRING			  Byte	 DGROUP:0005

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0030 Word	  Public  DATA
  _TEXT				  16  02D9 Word	  Public  CODE
