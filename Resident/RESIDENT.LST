Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 1
resident.asm



      1				     ;------------------------------------------------------------------------------
      2				     ;			      Card for Saint Valentine's Day (aka frame)
      3				     ;			     @Rogov Anatoliy 08.02.2025	"Sivchuk Bad Day"
      4				     ;------------------------------------------------------------------------------
      5
      6	      =0081		     cmd_line_add	     = 0081h								    +
      7				     ;cmd line address
      8	      =B800		     video_segment	     = 0b800h								    +
      9				     ;video segment
     10	      =0050		     window_len			     = 80							    +
     11				     ;window row length
     12	      =0019		     window_height	     = 25								    +
     13				     ;window column height
     14	      =0004		     reg_in_frame	     = 4								    +
     15				     ;amount of	registers in frame
     16
     17	0000			     .model tiny										    +
     18				     ;set 64 Kb	model
     19	0000			     .code											    +
     20				     ;define code block
     21				     org 100h											    +
     22				     ;prog's beginning ram block
     23
     24	0100  33 C0		     Start:  xor ax, ax										    +
     25				     ;ax = 0
     26	0102  8E C0				     mov es, ax									    +
     27				     ;es = 0
     28	0104  BB 0024				     mov bx, 09h * 4								    +
     29				     ;bx = &int	09h
     30
     31	0107  26: 8B 07				     mov ax, es:[bx]								    +
     32				     ;ax = old09h offset
     33	010A  A3 016Cr				     mov old09ofs, ax								    +
     34				     ;old09fs =	ax
     35	010D  26: 8B 47	02			     mov ax, es:[bx + 2]							    +
     36				     ;ax = old09h segment
     37	0111  A3 016Er				     mov old09seg, ax								    +
     38				     ;old09seg = ax
     39
     40	0114  26: C7 07	0130r			     mov es:[bx], offset New09h							    +
     41				     ;change 09h interrupt function by mine
     42	0119  8C C8				     mov ax, cs									    +
     43				     ;ax = cs
     44	011B  26: 89 47	02			     mov es:[bx	+ 2], ax							    +
     45				     ;current segment
     46
     47	011F  B8 3100				     mov ax, 3100h								    +
     48				     ;make program resident
     49	0122  BA 0034r				     mov dx, offset EOP								    +
     50				     ;dx = &EOP
     51	0125  D1 EA D1 EA D1 EA	D1+		     shr dx, 4									    +
     52	      EA		     ;dx /= 4
     53	012D  42				     inc dx									    +
     54				     ;dx += 1
     55	012E  CD 21				     int 21h									    +
     56				     ;31 function of 21	interrupt
     57
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 2
resident.asm



     58				     ;------------------------------------------------------------------------------
     59				     ; New procedural handler of 09h interrupt
     60				     ; Entry:		     NONE
     61				     ; Exit:		     NONE
     62				     ; Destroyed:    NONE
     63				     ;------------------------------------------------------------------------------
     64
     65	0130			     New09h  proc
     66	0130  50 53 51 52 06 56	55		     push ax bx	cx dx es si bp							    +
     67				     ;save all registers
     68
     69	0137  E4 60				     in	al, 60h									    +
     70				     ;al = scan	code from 60h port
     71	0139  3C 58				     cmp al, 58h								    +
     72				     ;if (al ==	F12) zf	= 1
     73	013B  75 17				     jne skip									    +
     74				     ;if (zf !=	1) goto	skip --------|
     75	013D  50 53 51 52 06 56	55+			     push ax bx	cx dx es si bp ds				     ;save  +
     76	      1E		     all registers			       |
     77																    +
     78				     ;								     |
     79	0145  8C CB					     mov bx, cs								    +
     80				     ;bx = code	segment				     |
     81	0147  8E DB					     mov ds, bx								    +
     82				     ;data segment = code segment    |
     83	0149  E8 0024					     call MainBorder							    +
     84				     ;Main Border function		     |
     85																    +
     86				     ;								     |
     87	014C  1F 5D 5E 07 5A 59	5B+			     pop ds bp si es dx	cx bx ax					    +
     88	      58		     ;return all registers		     |
     89	0154					     skip:									    +
     90				     ;<------------------------------|
     91
     92						     ;say that ready to	input new button by blink the bit
     93	0154  E4 61				     in	al, 61h									    +
     94				     ;al = value from 61h keyboard port
     95	0156  8A E0				     mov ah, al									    +
     96				     ;ah = al
     97	0158  0C 80				     or	al, 80h									    +
     98				     ;set the highest bit
     99	015A  E6 61				     out 61h, al								    +
    100				     ;out al to	61h keyboard port
    101	015C  8A C4				     mov al, ah									    +
    102				     ;al = ah
    103	015E  E6 61				     out 61h, al								    +
    104				     ;out al to	61h keyboard port
    105
    106	0160  B0 20				     mov al, 20h								    +
    107				     ;non-specific end of interrupt
    108	0162  E6 20				     out 20h, al								    +
    109				     ;interrupt	controller port
    110
    111	0164  5D 5E 07 5A 59 5B	58		     pop bp si es dx cx	bx ax							    +
    112				     ;return all registers after interrupt
    113	016B  EA					     db	0eah								    +
    114				     ;jump to old procedural handler of	09h interrupt
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 3
resident.asm



    115	016C  0000		     old09ofs	     dw	0									    +
    116				     ;previous offset
    117	016E  0000		     old09seg	     dw	0									    +
    118				     ;in segment
    119	0170					     endp
    120
    121				     ;------------------------------------------------------------------------------
    122
    123				     ;------------------------------------------------------------------------------
    124				     ; Main Border
    125				     ; Entry:		     None
    126				     ; Exit:		     SI
    127				     ; Destroyed:    SI, BP, BX, DX
    128				     ;------------------------------------------------------------------------------
    129
    130	0170			     MainBorder	     proc
    131
    132	0170  33 C0					     xor ax, ax								    +
    133				     ;ax = 0
    134	0172  33 DB					     xor bx, bx								    +
    135				     ;bx = 0
    136	0174  33 C9					     xor cx, cx								    +
    137				     ;cx = 0
    138	0176  33 D2					     xor dx, dx								    +
    139				     ;dx = 0
    140
    141	0178  BB B800					     mov bx, video_segment						    +
    142				     ;bx = video segment position
    143	017B  8E C3					     mov es, bx								    +
    144				     ;es = bx
    145
    146	017D  E8 00E7					     call CalcParam							    +
    147				     ;x_start, y_start,	y_string
    148	0180  E8 0011					     call SetStyle							    +
    149				     ;calculate	si
    150
    151	0183  8A 36 0001r				     mov dh, height							    +
    152				     ;dh = height
    153	0187  8A 16 0000r				     mov dl, len							    +
    154				     ;dl = len
    155	018B  33 FF					     xor di, di								    +
    156				     ;di = 0;
    157	018D  E8 0136					     call DrawFrame							    +
    158				     ;Drawing frame
    159	0190  E8 0010					     call DrawString							    +
    160				     ;Drawing string inside frame
    161
    162	0193  C3					     ret								    +
    163				     ;return function value
    164	0194						     endp								    +
    165				     ;proc's ending
    166
    167				     ;------------------------------------------------------------------------------
    168
    169				     ;------------------------------------------------------------------------------
    170				     ; Set frame style
    171				     ; Entry:		     None
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 4
resident.asm



    172				     ; Exit:		     SI
    173				     ; Destroyed:    SI, BP, BX, DX
    174				     ;------------------------------------------------------------------------------
    175
    176	0194			     SetStyle	     proc
    177
    178	0194  33 D2					     xor dx, dx								    +
    179				     ;dx = 0
    180	0196  BA 0010r					     mov dx, offset AXString						    +
    181				     ;dx = &AXString
    182	0199  BD 0006r					     mov bp, offset str_data_pos					    +
    183				     ;bp = &str_data_pos
    184	019C  89 56 00					     mov [bp], dx							    +
    185				     ;str_data_pos = AXString
    186
    187	019F  BE 0007r					     mov si, offset DoubleFrameString				     ;si =  +
    188				     &style string
    189
    190	01A2  C3					     ret								    +
    191				     ;return function value
    192	01A3						     endp								    +
    193				     ;proc's ending
    194
    195				     ;------------------------------------------------------------------------------
    196
    197				     ;------------------------------------------------------------------------------
    198				     ; Draw string inside the frame
    199				     ; Entry:		     None
    200				     ; Exit:		     None
    201				     ; Destroyed:    SI, BP, CX, AH
    202				     ;------------------------------------------------------------------------------
    203
    204	01A3			     DrawString	     proc
    205
    206	01A3  B9 0004					     mov cx, reg_in_frame						    +
    207				     ;cx = amount of registers
    208	01A6						     reg_str:								    +
    209				     ;<--------------------------------------------------------------|
    210	01A6  51						     push cx							    +
    211				     ;save cx											    +
    212				     |
    213	01A7  BD 0006r						     mov bp, offset str_data_pos				    +
    214				     ;bp = &str_data_pos									    +
    215				     |
    216	01AA  8B 76 00						     mov si, [bp]						    +
    217				     ;si = str_data_pos										    +
    218				     |
    219	01AD  33 C9						     xor cx, cx							    +
    220				     ;cx = 0											    +
    221				     |
    222	01AF  E8 0100						     call StrLen						    +
    223				     ;cx = len(si)										    +
    224				     |
    225	01B2  51						     push cx							    +
    226				     ;save len											    +
    227				     |
    228																    +
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 5
resident.asm



    229				     ;						     Shifting					    +
    230				     |
    231	01B3  BD 0006r						     mov bp, offset str_data_pos				    +
    232				     ;bp = &str_data_pos									    +
    233				     |
    234	01B6  8B 76 00						     mov si, [bp]						    +
    235				     ;si = &inside frame string									    +
    236				     |
    237	01B9  E8 00C9						     call EvalShift						    +
    238				     ;di = 2 * window_len * y_start + (x_start + (cx - len) / 2) * 2 |
    239																    +
    240				     ;						     Print					    +
    241				     |
    242	01BC  8A 26 0002r					     mov ah, frame_color					    +
    243				     ;ah = string color										    +
    244				     |
    245	01C0  E8 00FA						     call PrintInsideString					    +
    246				     ;print string										    +
    247				     |
    248																    +
    249				     ;						     Next Row					    +
    250				     |
    251	01C3  59						     pop cx							    +
    252				     ;return len										    +
    253				     |
    254	01C4  BD 0006r						     mov bp, offset str_data_pos				    +
    255				     ;bp = &str_data_pos									    +
    256				     |
    257	01C7  41						     inc cx							    +
    258				     ;cx += 1											    +
    259				     |
    260	01C8  01 4E 00						     add [bp], cx						    +
    261				     ;str_data_pos = len + 1									    +
    262				     |
    263	01CB  80 06 0005r 01					     add y_string, 1						    +
    264				     ;y_string += 1										    +
    265				     |
    266	01D0  59						     pop cx							    +
    267				     ;return loop counter									    +
    268				     |
    269																    +
    270				     ;						     Out Register
    271	01D1  83 EF 08						     sub di, 2 * 4
    272	01D4  50 53 51 52					     push ax bx	cx dx
    273	01D8  BD 0030r						     mov bp, offset print_ax
    274	01DB  83 ED 04						     sub bp, reg_in_frame
    275	01DE  03 E9						     add bp, cx
    276	01E0  50						     push ax
    277	01E1  8A 46 00						     mov al, [bp]
    278	01E4  A2 01E8r						     mov CurReg, al
    279	01E7  58						     pop ax
    280	01E8  00						     CurReg db 0
    281	01E9  E8 0007						     call OutAx
    282	01EC  58 5B 59 5A					     pop ax bx cx dx
    283
    284	01F0  E2 B4					     loop reg_str							    +
    285				     ;---------------------------------------------------------------|
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 6
resident.asm



    286
    287	01F2  C3					     ret								    +
    288				     ;return function value
    289	01F3						     endp								    +
    290				     ;proc's ending
    291
    292				     ;------------------------------------------------------------------------------
    293
    294				     ;------------------------------------------------------------------------------
    295				     ; Show ax register	value
    296				     ; Entry:		     AX	- printing value
    297				     ; Exit:		     NONE
    298				     ; Destroyed:    CX, BX, DX, AX
    299				     ;------------------------------------------------------------------------------
    300
    301	01F3			     OutAx   proc
    302
    303	01F3  B1 10				     mov cl, 16
    304
    305	01F5					     division:
    306	01F5  F6 F1					     div cl
    307	01F7  80 FC 0A					     cmp ah, 10
    308	01FA  73 06					     jae letter
    309
    310	01FC  80 C4 30						     add ah, '0'
    311	01FF  EB 04 90						     jmp both_print_reg
    312	0202						     letter:
    313	0202  80 C4 37						     add ah, 'A' - 10
    314
    315	0205						     both_print_reg:
    316	0205  8A E8					     mov ch, al
    317	0207  86 E0					     xchg ah, al
    318	0209  8A 26 0002r				     mov     ah, frame_color
    319	020D  AB					     stosw
    320	020E  8A C5					     mov al, ch
    321	0210  32 E4					     xor ah, ah
    322	0212  3C 00					     cmp al, 0
    323	0214  75 DF					     jne division
    324
    325	0216  C3				     ret									    +
    326				     ;return function value
    327	0217					     endp									    +
    328				     ;proc's ending
    329
    330				     ;------------------------------------------------------------------------------
    331
    332				     ;------------------------------------------------------------------------------
    333				     ; ASCII code symbols to hex integer (ABCDEF instead of abcdef)
    334				     ; Entry:		     AL	- first	symbol
    335				     ; Exit:		     BL	- hex
    336				     ; Destroyed:    CX, BX, DX, AX
    337				     ;------------------------------------------------------------------------------
    338
    339	0217			     Atoh    proc
    340
    341	0217  B9 0001				     mov cx, 1									    +
    342				     ;cx = 1
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 7
resident.asm



    343	021A  33 DB				     xor bx, bx									    +
    344				     ;bx = 0
    345	021C  33 D2				     xor dx, dx									    +
    346				     ;dx = 0
    347	021E  32 E4				     xor ah, ah									    +
    348				     ;ah = 0
    349
    350	0220					     get_hex:									    +
    351				     ;<--------------------------|
    352	0220  3C 20					     cmp al, ' '							    +
    353				     ;if (al ==	' ') zf	= 1	     |
    354	0222  74 1D					     je	end_atoh							    +
    355				     ;if (zf ==	1) goto	end_atoi     |
    356																    +
    357				     ;							     |
    358	0224  D1 E3 D1 E3 D1 E3	D1+			     shl bx, 4								    +
    359	      E3		     ;bx *= 16					     |
    360																    +
    361				     ;							     |
    362	022C  3C 41					     cmp al, 'A'							    +
    363				     ;if (al - 65 < 0) fs = 1	     |
    364	022E  79 06					     jns no_sign							    +
    365				     ;if (fs !=	1) goto	no_sign	     |
    366	0230  2D 0030					     sub ax, '0'							    +
    367				     ;ax -= 48					     |
    368	0233  EB 04 90					     jmp both								    +
    369				     ;goto both					     |
    370	0236						     no_sign:								    +
    371				     ;							     |
    372	0236  2D 0037						     sub ax, 55							    +
    373				     ;ax -= 55					     |
    374	0239						     both:								    +
    375				     ;							     |
    376	0239  03 D8					     add bx, ax								    +
    377				     ;bx += ax					     |
    378																    +
    379				     ;							     |
    380	023B  83 C1 02					     add cx, 2								    +
    381				     ;cx += 2					     |
    382	023E  AC					     lodsb								    +
    383				     ;mov al, ds:[si]			     |
    384	023F  E2 DF				     loop get_hex								    +
    385				     ;---------------------------|
    386	0241					     end_atoh:
    387
    388	0241  C3				     ret									    +
    389				     ;return function value
    390	0242					     endp									    +
    391				     ;proc's ending
    392
    393				     ;------------------------------------------------------------------------------
    394
    395				     ;------------------------------------------------------------------------------
    396				     ; ASCII code symbols to integer
    397				     ; Entry:		     AL	- first	symbol
    398				     ; Exit:		     BL	- integer
    399				     ; Destroyed:    CX, BX, DX, AX
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 8
resident.asm



    400				     ;------------------------------------------------------------------------------
    401
    402	0242			     Atoi    proc
    403
    404	0242  B9 0001				     mov cx, 1									    +
    405				     ;cx = 1
    406	0245  33 DB				     xor bx, bx									    +
    407				     ;bx = 0
    408	0247  33 D2				     xor dx, dx									    +
    409				     ;dx = 0
    410	0249  32 E4				     xor ah, ah									    +
    411				     ;ah = 0
    412
    413	024B					     get_symbol:								    +
    414				     ;<--------------------------|
    415	024B  3C 20					     cmp al, ' '							    +
    416				     ;if (al ==	' ') zf	= 1	     |
    417	024D  74 17					     je	end_atoi							    +
    418				     ;if (zf ==	1) goto	end_atoi     |
    419																    +
    420				     ;							     |
    421	024F  53					     push bx								    +
    422				     ;save bx					     |
    423	0250  D1 E3 D1 E3 D1 E3				     shl bx, 3								    +
    424				     ;bx *= 8					     |
    425																    +
    426				     ;							     |
    427	0256  5A					     pop dx								    +
    428				     ;return bx: dx = bx		     |
    429	0257  D1 E2					     shl dx, 1								    +
    430				     ;dx *= 2					     |
    431	0259  03 DA					     add bx, dx								    +
    432				     ;bx += dx					     |
    433																    +
    434				     ;							     |
    435	025B  2D 0030					     sub ax, 48								    +
    436				     ;ax -= 48					     |
    437	025E  03 D8					     add bx, ax								    +
    438				     ;bx += ax					     |
    439																    +
    440				     ;							     |
    441	0260  83 C1 02					     add cx, 2								    +
    442				     ;cx += 2					     |
    443	0263  AC					     lodsb								    +
    444				     ;mov al, ds:[si]			     |
    445	0264  E2 E5				     loop get_symbol								    +
    446				     ;---------------------------|
    447	0266					     end_atoi:
    448
    449	0266  C3				     ret									    +
    450				     ;return function value
    451	0267					     endp									    +
    452				     ;proc's ending
    453
    454				     ;------------------------------------------------------------------------------
    455
    456				     ;------------------------------------------------------------------------------
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 9
resident.asm



    457				     ; Calculate values	of variables: x_start, y_start,	y_string
    458				     ; Entry:		     None
    459				     ; Exit:		     None
    460				     ; Destroyed:    AX, BX, DX, BP
    461				     ;------------------------------------------------------------------------------
    462
    463	0267			     CalcParam	     proc
    464
    465							     ;x_start =	window_len - len
    466	0267  A0 0000r					     mov al, len							    +
    467				     ;al = len
    468	026A  B3 50					     mov bl, window_len							    +
    469				     ;bp = 80
    470	026C  88 1E 0003r				     mov x_start, bl							    +
    471				     ;x_start =	80
    472	0270  28 06 0003r				     sub x_start, al							    +
    473				     ;x_start -= len
    474
    475	0274  C6 06 0004r 02 90				     mov y_start, 2							    +
    476				     ;y_start =	1
    477
    478	027A  8A 1E 0004r				     mov bl, y_start							    +
    479				     ;bp = y_start
    480	027E  FE C3					     inc bl								    +
    481				     ;bl += 1
    482	0280  88 1E 0005r				     mov y_string, bl							    +
    483				     ;y_string = y_start + 1
    484
    485	0284  C3					     ret								    +
    486				     ;return function value
    487	0285						     endp								    +
    488				     ;proc's ending
    489
    490				     ;------------------------------------------------------------------------------
    491
    492				     ;------------------------------------------------------------------------------
    493				     ; Eval shift of frame inside string
    494				     ; Entry:		     CX	= string length
    495				     ; Exit:		     None
    496				     ; Destroyed:    DI, BP, AX, BX
    497				     ;------------------------------------------------------------------------------
    498
    499	0285			     EvalShift	     proc
    500
    501							     ;di = y_string * window_len * 2 + (x_start	+ (cx -	len) / 2) * 2
    502	0285  A0 0005r					     mov al, y_string							    +
    503				     ;al = y_string
    504	0288  D0 E0					     shl al, 1								    +
    505				     ;al *= 2
    506	028A  32 E4					     xor ah, ah								    +
    507				     ;ah = 0
    508	028C  BD 0050					     mov bp, window_len							    +
    509				     ;bp = 80
    510	028F  52					     push dx								    +
    511				     ;save size	of frame in stack
    512	0290  F7 E5					     mul bp								    +
    513				     ;ax = 2 * y_start * 80
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 10
resident.asm



    514	0292  5A					     pop dx								    +
    515				     ;return size of frame from	stack to dxâ‰ˆ
    516	0293  8B F8					     mov di, ax								    +
    517				     ;di = ax
    518
    519	0295  32 E4					     xor ah, ah								    +
    520				     ;ah = 0
    521	0297  32 FF					     xor bh, bh								    +
    522				     ;bh = 0
    523	0299  A0 0003r					     mov al, x_start							    +
    524				     ;al = x_start
    525	029C  BD 0000r					     mov bp, offset len							    +
    526				     ;bp = &len
    527	029F  8A 1E 0000r				     mov bl, len							    +
    528				     ;bl = len
    529	02A3  2A D9					     sub bl, cl								    +
    530				     ;bl -= cl
    531	02A5  D0 EB					     shr bl, 1								    +
    532				     ;bl = (cx - len) /	2
    533	02A7  02 C3					     add al, bl								    +
    534				     ;x_start += (cx - len) / 2
    535	02A9  D0 E0					     shl al, 1								    +
    536				     ;al *= 2
    537	02AB  03 F8					     add di, ax								    +
    538				     ;di += al
    539
    540	02AD  D1 EF					     shr di, 1								    +
    541				     ;di /= 2
    542	02AF  D1 E7					     shl di, 1								    +
    543				     ;di *= 2
    544
    545	02B1  C3					     ret								    +
    546				     ;return function value
    547	02B2						     endp								    +
    548				     ;proc's ending
    549
    550				     ;------------------------------------------------------------------------------
    551
    552
    553				     ;------------------------------------------------------------------------------
    554				     ; Eval string length with '$' terminal symbol
    555				     ; Entry:		     SI	= data string address
    556				     ; Exit:		     CX
    557				     ; Destroyed:    SI, AL, CX
    558				     ;------------------------------------------------------------------------------
    559
    560	02B2			     StrLen  proc
    561
    562	02B2					     str_len:									    +
    563				     ;<------------------------------|
    564	02B2  AC					     lodsb								    +
    565				     ;mov al, ds:[si]				     |
    566	02B3  3C 24					     cmp al, '$'							    +
    567				     ;if (al ==	'$') zf	= 1		     |
    568	02B5  74 05					     jz	end_str_len							    +
    569				     ;if (zf ==	1) goto	end_str_len  |
    570	02B7  83 C1 02					     add cx, 2								    +
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 11
resident.asm



    571				     ;cx += 2						     |
    572	02BA  E2 F6				     loop str_len								    +
    573				     ;-------------------------------|
    574	02BC					     end_str_len:								    +
    575				     ;label of str len ending
    576
    577	02BC  C3				     ret									    +
    578				     ;return function value
    579	02BD					     endp									    +
    580				     ;proc's ending
    581
    582				     ;------------------------------------------------------------------------------
    583
    584				     ;------------------------------------------------------------------------------
    585				     ; Print string inside the frame
    586				     ; Entry:		     BX	= data string address
    587				     ;				     AH	= string color
    588				     ;				     CX	= string length
    589				     ; Exit:		     None
    590				     ; Destroyed:    BX, AL, DI
    591				     ;------------------------------------------------------------------------------
    592
    593	02BD			     PrintInsideString	     proc
    594
    595	02BD								     print_string:					    +
    596				     ;<----------------------------------|
    597	02BD  AC								     lodsb					    +
    598				     ;mov al, ds:[si]					     |
    599	02BE  AB								     stosw					    +
    600				     ;mov es:[di], ax /	add di,	2	     |
    601	02BF  3C 24								     cmp al, '$'				    +
    602				     ;if (al ==	'$') zf	= 1			     |
    603	02C1  74 02								     jz	end_print_string			    +
    604				     ;if (zf ==	1) goto	end_print_string     |
    605	02C3  E2 F8							     loop print_string					    +
    606				     ;-----------------------------------|
    607	02C5								     end_print_string:					    +
    608				     ;label of print string ending
    609
    610	02C5  C3							     ret						    +
    611				     ;return function value
    612	02C6								     endp						    +
    613				     ;proc's ending
    614
    615				     ;------------------------------------------------------------------------------
    616
    617				     ;------------------------------------------------------------------------------
    618				     ; Draw frame with size: len, height
    619				     ; Entry:		     SI	= data string address
    620				     ;				     DH	= frame	height
    621				     ;				     DL	= frame	len
    622				     ; Exit:		     None
    623				     ; Destroyed:    BX, CX, DI
    624				     ;------------------------------------------------------------------------------
    625
    626	02C6			     DrawFrame	     proc
    627
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 12
resident.asm



    628	02C6  A0 0004r					     mov al, y_start							    +
    629				     ;al = y_start
    630	02C9  D0 E0					     shl al, 1								    +
    631				     ;al *= 2
    632	02CB  BD 0050					     mov bp, window_len							    +
    633				     ;bp = 80
    634	02CE  52					     push dx								    +
    635				     ;save size	of frame in stack
    636	02CF  F7 E5					     mul bp								    +
    637				     ;ax = 2 * y_start * 80
    638	02D1  5A					     pop dx								    +
    639				     ;return size of frame from	stack to dx
    640	02D2  8B F8					     mov di, ax								    +
    641				     ;di = ax
    642	02D4  A0 0003r					     mov al, x_start							    +
    643				     ;ax = x_start
    644	02D7  D0 E0					     shl al, 1								    +
    645				     ;ax *= 2
    646	02D9  32 E4					     xor ah, ah								    +
    647				     ;ah = 0
    648	02DB  03 F8					     add di, ax								    +
    649				     ;di += 2 *	x_start
    650	02DD  E8 001E					     call PrintString							    +
    651				     ;print string
    652
    653	02E0  8A CE					     mov cl, dh								    +
    654				     ;loop on length of	frame string
    655	02E2  32 ED					     xor ch, ch								    +
    656				     ;ch = 0
    657	02E4  83 E9 02					     sub cx, 2								    +
    658				     ;without first and	lsat symbols of	string
    659	02E7						     cycle1:								    +
    660				     ;<--------------------------|
    661	02E7  81 C7 00A0					     add di, window_len	* 2					    +
    662				     ;di += window_len * 2	     |
    663	02EB  E8 0010						     call PrintString						    +
    664				     ;print string			     |
    665	02EE  83 EE 03						     sub si, 3							    +
    666				     ;si -= 3					     |
    667	02F1  E2 F4					     loop cycle1							    +
    668				     ;---------------------------|
    669	02F3  83 C6 03					     add si, 3								    +
    670				     ;si += 3
    671
    672	02F6  81 C7 00A0				     add di, window_len	* 2						    +
    673				     ;di += window_len * 2 (next line)
    674	02FA  E8 0001					     call PrintString							    +
    675				     ;print string
    676
    677	02FD  C3					     ret								    +
    678				     ;return function value
    679	02FE						     endp								    +
    680				     ;proc's ending
    681
    682				     ;------------------------------------------------------------------------------
    683
    684				     ;------------------------------------------------------------------------------
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 13
resident.asm



    685				     ; Draws string to console in format: s1s2....s2s3
    686				     ; Entry:		     SI	= string address
    687				     ;				     DL	= string len
    688				     ; Exit:		     None
    689				     ; Destroyed:    AX, BX, CX, SI
    690				     ;------------------------------------------------------------------------------
    691
    692	02FE			     PrintString     proc
    693
    694	02FE  8A 26 0002r				     mov ah, frame_color						    +
    695				     ;set symbols color
    696
    697	0302  AC					     lodsb								    +
    698				     ;mov al, ds:[si]
    699	0303  AB					     stosw								    +
    700				     ;mov es:[di], ax /	add di,	2
    701
    702	0304  51					     push cx								    +
    703				     ;save prev	loop cnt
    704	0305  8A CA					     mov cl, dl								    +
    705				     ;counter =	dl
    706	0307  80 E9 02					     sub cl, 2								    +
    707				     ;without top and bottom line
    708	030A  8A 04					     mov al, [si]							    +
    709				     ;al = [si]
    710	030C						     cycle:								    +
    711				     ;<------------------------------|
    712	030C  AB						     stosw							    +
    713				     ;mov es:[di], ax /	add di,	2    |
    714	030D  E2 FD					     loop cycle								    +
    715				     ;-------------------------------|
    716	030F  46					     inc si								    +
    717				     ;bx++
    718	0310  59					     pop cx								    +
    719				     ;return prev loop cnt
    720
    721	0311  AC					     lodsb								    +
    722				     ;mov al, ds:[si]
    723	0312  AB					     stosw								    +
    724				     ;mov es:[di], ax /	add di,	2
    725
    726	0313  8A DA					     mov bl, dl								    +
    727				     ;bl = dl
    728	0315  32 FF					     xor bh, bh								    +
    729				     ;bh = 0
    730	0317  D1 E3					     shl bx, 1								    +
    731				     ;bx *= 2
    732	0319  2B FB					     sub di, bx								    +
    733				     ;set di to	line beginning
    734
    735	031B  C3					     ret								    +
    736				     ;return function value
    737	031C						     endp								    +
    738				     ;proc's ending
    739
    740				     ;------------------------------------------------------------------------------
    741
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 14
resident.asm



    742	031C			     .data
    743	0000  13		     len			     db	19							    +
    744				     ;frame row	length
    745	0001  07		     height			     db	7							    +
    746				     ;frame column height
    747	0002  4E		     frame_color	     db	4eh								    +
    748				     ;frame element color
    749
    750	0003  00		     x_start			     db	0							    +
    751				     ;x	frame start position
    752	0004  00		     y_start			     db	0							    +
    753				     ;y	frame start position
    754	0005  00		     y_string			     db	0							    +
    755				     ;y	string start position
    756	0006  00		     str_data_pos	     db	0								    +
    757				     ;cmd line position	of string
    758
    759	0007  C9 CD BB BA 20 BA	C8+  DoubleFrameString	     db	'ÉÍ»º ºÈÍ¼'
    760	      CD BC
    761
    762	0010  61 78 20 30 30 30	30+  AXString			     db	"ax 0000$"
    763	      24
    764	0018  62 78 20 30 30 30	30+  BXString			     db	"bx 0000$"
    765	      24
    766	0020  63 78 20 30 30 30	30+  CXString			     db	"cx 0000$"
    767	      24
    768	0028  64 78 20 30 30 30	30+  DXString			     db	"dx 0000$"
    769	      24
    770
    771	0030  90		     print_ax			     db	090h
    772	0031  93		     print_bx			     db	093h
    773	0032  91		     print_cx			     db	091h
    774	0033  92		     print_dx			     db	092h
    775
    776	0034			     EOP:
    777				     end     Start										    +
    778				     ;prog's ending
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 15
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/24/25"
??FILENAME			  Text	 "resident"
??TIME				  Text	 "10:02:36"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _DATA
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 RESIDENT
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ATOH				  Near	 DGROUP:0217
ATOI				  Near	 DGROUP:0242
AXSTRING			  Byte	 DGROUP:0010
BOTH				  Near	 DGROUP:0239
BOTH_PRINT_REG			  Near	 DGROUP:0205
BXSTRING			  Byte	 DGROUP:0018
CALCPARAM			  Near	 DGROUP:0267
CMD_LINE_ADD			  Number 0081
CURREG				  Byte	 DGROUP:01E8
CXSTRING			  Byte	 DGROUP:0020
CYCLE				  Near	 DGROUP:030C
CYCLE1				  Near	 DGROUP:02E7
DIVISION			  Near	 DGROUP:01F5
DOUBLEFRAMESTRING		  Byte	 DGROUP:0007
DRAWFRAME			  Near	 DGROUP:02C6
DRAWSTRING			  Near	 DGROUP:01A3
DXSTRING			  Byte	 DGROUP:0028
END_ATOH			  Near	 DGROUP:0241
END_ATOI			  Near	 DGROUP:0266
END_PRINT_STRING		  Near	 DGROUP:02C5
END_STR_LEN			  Near	 DGROUP:02BC
EOP				  Near	 DGROUP:0034
EVALSHIFT			  Near	 DGROUP:0285
FRAME_COLOR			  Byte	 DGROUP:0002
GET_HEX				  Near	 DGROUP:0220
GET_SYMBOL			  Near	 DGROUP:024B
HEIGHT				  Byte	 DGROUP:0001
LEN				  Byte	 DGROUP:0000
LETTER				  Near	 DGROUP:0202
MAINBORDER			  Near	 DGROUP:0170
NEW09H				  Near	 DGROUP:0130
NO_SIGN				  Near	 DGROUP:0236
OLD09OFS			  Word	 DGROUP:016C
OLD09SEG			  Word	 DGROUP:016E
OUTAX				  Near	 DGROUP:01F3
PRINTINSIDESTRING		  Near	 DGROUP:02BD
PRINTSTRING			  Near	 DGROUP:02FE
PRINT_AX			  Byte	 DGROUP:0030
Turbo Assembler	 Version 4.1	    02/24/25 10:02:37	    Page 16
Symbol Table



PRINT_BX			  Byte	 DGROUP:0031
PRINT_CX			  Byte	 DGROUP:0032
PRINT_DX			  Byte	 DGROUP:0033
PRINT_STRING			  Near	 DGROUP:02BD
REG_IN_FRAME			  Number 0004
REG_STR				  Near	 DGROUP:01A6
SETSTYLE			  Near	 DGROUP:0194
SKIP				  Near	 DGROUP:0154
START				  Near	 DGROUP:0100
STRLEN				  Near	 DGROUP:02B2
STR_DATA_POS			  Byte	 DGROUP:0006
STR_LEN				  Near	 DGROUP:02B2
VIDEO_SEGMENT			  Number B800
WINDOW_HEIGHT			  Number 0019
WINDOW_LEN			  Number 0050
X_START				  Byte	 DGROUP:0003
Y_START				  Byte	 DGROUP:0004
Y_STRING			  Byte	 DGROUP:0005

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0034 Word	  Public  DATA
  _TEXT				  16  031C Word	  Public  CODE
