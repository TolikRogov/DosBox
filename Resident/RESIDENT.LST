Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 1
resident.asm



      1				     ;------------------------------------------------------------------------------
      2				     ;			      Card for Saint Valentine's Day (aka frame)
      3				     ;			     @Rogov Anatoliy 08.02.2025	"Sivchuk Bad Day"
      4				     ;------------------------------------------------------------------------------
      5
      6	      =0081		     cmd_line_add	     = 0081h								    +
      7				     ;cmd line address
      8	      =B800		     video_segment	     = 0b800h								    +
      9				     ;video segment
     10	      =0050		     window_len			     = 80							    +
     11				     ;window row length
     12	      =0019		     window_height	     = 25								    +
     13				     ;window column height
     14	      =0004		     reg_in_frame	     = 4								    +
     15				     ;amount of	registers in frame
     16
     17	0000			     .model tiny										    +
     18				     ;set 64 Kb	model
     19	0000			     .code											    +
     20				     ;define code block
     21				     org 100h											    +
     22				     ;prog's beginning ram block
     23
     24	0100  33 C0		     Start:  xor ax, ax										    +
     25				     ;ax = 0
     26	0102  8E C0				     mov es, ax									    +
     27				     ;es = 0
     28	0104  BB 0024				     mov bx, 09h * 4								    +
     29				     ;bx = &int	09h
     30
     31	0107  26: 8B 07				     mov ax, es:[bx]								    +
     32				     ;ax = old09h offset
     33	010A  A3 016Cr				     mov old09ofs, ax								    +
     34				     ;old09fs =	ax
     35	010D  26: 8B 47	02			     mov ax, es:[bx + 2]							    +
     36				     ;ax = old09h segment
     37	0111  A3 016Er				     mov old09seg, ax								    +
     38				     ;old09seg = ax
     39
     40	0114  26: C7 07	0130r			     mov es:[bx], offset New09h							    +
     41				     ;change 09h interrupt function by mine
     42	0119  8C C8				     mov ax, cs									    +
     43				     ;ax = cs
     44	011B  26: 89 47	02			     mov es:[bx	+ 2], ax							    +
     45				     ;current segment
     46
     47	011F  B8 3100				     mov ax, 3100h								    +
     48				     ;make program resident
     49	0122  BA 0030r				     mov dx, offset EOP								    +
     50				     ;dx = &EOP
     51	0125  D1 EA D1 EA D1 EA	D1+		     shr dx, 4									    +
     52	      EA		     ;dx /= 4
     53	012D  42				     inc dx									    +
     54				     ;dx += 1
     55	012E  CD 21				     int 21h									    +
     56				     ;31 function of 21	interrupt
     57
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 2
resident.asm



     58				     ;------------------------------------------------------------------------------
     59				     ; New procedural handler of 09h interrupt
     60				     ; Entry:		     NONE
     61				     ; Exit:		     NONE
     62				     ; Destroyed:    NONE
     63				     ;------------------------------------------------------------------------------
     64
     65	0130			     New09h  proc
     66	0130  50 53 51 52 06 56	55		     push ax bx	cx dx es si bp							    +
     67				     ;save all registers
     68
     69	0137  E4 60				     in	al, 60h									    +
     70				     ;al = scan	code from 60h port
     71	0139  3C 58				     cmp al, 58h								    +
     72				     ;if (al ==	F12) zf	= 1
     73	013B  75 17				     jne skip									    +
     74				     ;if (zf !=	1) goto	skip --------|
     75	013D  50 53 51 52 06 56	55+			     push ax bx	cx dx es si bp ds				     ;save  +
     76	      1E		     all registers			       |
     77																    +
     78				     ;								     |
     79	0145  8C CB					     mov bx, cs								    +
     80				     ;bx = code	segment				     |
     81	0147  8E DB					     mov ds, bx								    +
     82				     ;data segment = code segment    |
     83	0149  E8 0024					     call MainBorder							    +
     84				     ;Main Border function		     |
     85																    +
     86				     ;								     |
     87	014C  1F 5D 5E 07 5A 59	5B+			     pop ds bp si es dx	cx bx ax					    +
     88	      58		     ;return all registers		     |
     89	0154					     skip:									    +
     90				     ;<------------------------------|
     91
     92						     ;say that ready to	input new button by blink the bit
     93	0154  E4 61				     in	al, 61h									    +
     94				     ;al = value from 61h keyboard port
     95	0156  8A E0				     mov ah, al									    +
     96				     ;ah = al
     97	0158  0C 80				     or	al, 80h									    +
     98				     ;set the highest bit
     99	015A  E6 61				     out 61h, al								    +
    100				     ;out al to	61h keyboard port
    101	015C  8A C4				     mov al, ah									    +
    102				     ;al = ah
    103	015E  E6 61				     out 61h, al								    +
    104				     ;out al to	61h keyboard port
    105
    106	0160  B0 20				     mov al, 20h								    +
    107				     ;non-specific end of interrupt
    108	0162  E6 20				     out 20h, al								    +
    109				     ;interrupt	controller port
    110
    111	0164  5D 5E 07 5A 59 5B	58		     pop bp si es dx cx	bx ax							    +
    112				     ;return all registers after interrupt
    113	016B  EA					     db	0eah								    +
    114				     ;jump to old procedural handler of	09h interrupt
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 3
resident.asm



    115	016C  0000		     old09ofs	     dw	0									    +
    116				     ;previous offset
    117	016E  0000		     old09seg	     dw	0									    +
    118				     ;in segment
    119	0170					     endp
    120
    121				     ;------------------------------------------------------------------------------
    122
    123				     ;------------------------------------------------------------------------------
    124				     ; Main Border
    125				     ; Entry:		     None
    126				     ; Exit:		     SI
    127				     ; Destroyed:    SI, BP, BX, DX
    128				     ;------------------------------------------------------------------------------
    129
    130	0170			     MainBorder	     proc
    131
    132	0170  33 C0					     xor ax, ax								    +
    133				     ;ax = 0
    134	0172  33 DB					     xor bx, bx								    +
    135				     ;bx = 0
    136	0174  33 C9					     xor cx, cx								    +
    137				     ;cx = 0
    138	0176  33 D2					     xor dx, dx								    +
    139				     ;dx = 0
    140
    141	0178  BB B800					     mov bx, video_segment						    +
    142				     ;bx = video segment position
    143	017B  8E C3					     mov es, bx								    +
    144				     ;es = bx
    145
    146	017D  E8 00FB					     call CalcParam							    +
    147				     ;x_start, y_start,	y_string
    148	0180  E8 0011					     call SetStyle							    +
    149				     ;calculate	si
    150
    151	0183  8A 36 0001r				     mov dh, height							    +
    152				     ;dh = height
    153	0187  8A 16 0000r				     mov dl, len							    +
    154				     ;dl = len
    155	018B  33 FF					     xor di, di								    +
    156				     ;di = 0;
    157	018D  E8 014A					     call DrawFrame							    +
    158				     ;Drawing frame
    159	0190  E8 0010					     call DrawString							    +
    160				     ;Drawing string inside frame
    161
    162	0193  C3					     ret								    +
    163				     ;return function value
    164	0194						     endp								    +
    165				     ;proc's ending
    166
    167				     ;------------------------------------------------------------------------------
    168
    169				     ;------------------------------------------------------------------------------
    170				     ; Set frame style
    171				     ; Entry:		     None
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 4
resident.asm



    172				     ; Exit:		     SI
    173				     ; Destroyed:    SI, BP, BX, DX
    174				     ;------------------------------------------------------------------------------
    175
    176	0194			     SetStyle	     proc
    177
    178	0194  33 D2					     xor dx, dx								    +
    179				     ;dx = 0
    180	0196  BA 0010r					     mov dx, offset AXString						    +
    181				     ;dx = &AXString
    182	0199  BD 0006r					     mov bp, offset str_data_pos					    +
    183				     ;bp = &str_data_pos
    184	019C  89 56 00					     mov [bp], dx							    +
    185				     ;str_data_pos = AXString
    186
    187	019F  BE 0007r					     mov si, offset DoubleFrameString				     ;si =  +
    188				     &style string
    189
    190	01A2  C3					     ret								    +
    191				     ;return function value
    192	01A3						     endp								    +
    193				     ;proc's ending
    194
    195				     ;------------------------------------------------------------------------------
    196
    197				     ;------------------------------------------------------------------------------
    198				     ; Draw string inside the frame
    199				     ; Entry:		     None
    200				     ; Exit:		     None
    201				     ; Destroyed:    SI, BP, CX, AH
    202				     ;------------------------------------------------------------------------------
    203
    204	01A3			     DrawString	     proc
    205
    206	01A3  B9 0004					     mov cx, reg_in_frame						    +
    207				     ;cx = amount of registers
    208	01A6						     reg_str:								    +
    209				     ;<--------------------------------------------------------------|
    210	01A6  51						     push cx							    +
    211				     ;save cx											    +
    212				     |
    213	01A7  BD 0006r						     mov bp, offset str_data_pos				    +
    214				     ;bp = &str_data_pos									    +
    215				     |
    216	01AA  8B 76 00						     mov si, [bp]						    +
    217				     ;si = str_data_pos										    +
    218				     |
    219	01AD  33 C9						     xor cx, cx							    +
    220				     ;cx = 0											    +
    221				     |
    222	01AF  E8 0114						     call StrLen						    +
    223				     ;cx = len(si)										    +
    224				     |
    225	01B2  51						     push cx							    +
    226				     ;save len											    +
    227				     |
    228																    +
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 5
resident.asm



    229				     ;												    +
    230				     |
    231	01B3  BD 0006r						     mov bp, offset str_data_pos				    +
    232				     ;bp = &str_data_pos									    +
    233				     |
    234	01B6  8B 76 00						     mov si, [bp]						    +
    235				     ;si = &inside frame string									    +
    236				     |
    237	01B9  E8 00DD						     call EvalShift						    +
    238				     ;di = 2 * window_len * y_start + (x_start + (cx - len) / 2) * 2 |
    239																    +
    240				     ;												    +
    241				     |
    242	01BC  8A 26 0002r					     mov ah, frame_color					    +
    243				     ;ah = string color										    +
    244				     |
    245	01C0  E8 010E						     call PrintInsideString					    +
    246				     ;print string										    +
    247				     |
    248																    +
    249				     ;												    +
    250				     |
    251	01C3  59						     pop cx							    +
    252				     ;return len										    +
    253				     |
    254	01C4  BD 0006r						     mov bp, offset str_data_pos				    +
    255				     ;bp = &str_data_pos									    +
    256				     |
    257	01C7  41						     inc cx							    +
    258				     ;cx += 1											    +
    259				     |
    260	01C8  01 4E 00						     add [bp], cx						    +
    261				     ;str_data_pos = len + 1									    +
    262				     |
    263	01CB  80 06 0005r 01					     add y_string, 1						    +
    264				     ;y_string += 1										    +
    265				     |
    266	01D0  59						     pop cx							    +
    267				     ;return loop counter									    +
    268				     |
    269
    270	01D1  83 EF 08						     sub di, 2 * 4
    271	01D4  50 53						     push ax bx
    272	01D6  8B D8						     mov bx, ax
    273								     shr bx, 16
**Error** resident.asm(163) Rotate count out of	range
    274	01D8  8B C3						     mov ax, bx
    275	01DA  AB						     stosw
    276	01DB  5B 58						     pop bx ax
    277
    278	01DD  50 53						     push ax bx
    279	01DF  8B D8						     mov bx, ax
    280	01E1  D1 EB D1 EB D1 EB	D1+				     shr bx, 12
    281	      EB D1 EB D1 EB D1	EB+
    282	      D1 EB D1 EB D1 EB	D1+
    283	      EB D1 EB
    284	01F9  8B C3						     mov ax, bx
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 6
resident.asm



    285	01FB  AB						     stosw
    286	01FC  5B 58						     pop bx ax
    287
    288	01FE  50 53						     push ax bx
    289	0200  8B D8						     mov bx, ax
    290	0202  D1 EB D1 EB D1 EB	D1+				     shr bx, 8
    291	      EB D1 EB D1 EB D1	EB+
    292	      D1 EB
    293	0212  8B C3						     mov ax, bx
    294	0214  AB						     stosw
    295	0215  5B 58						     pop bx ax
    296
    297	0217  50 53						     push ax bx
    298	0219  8B D8						     mov bx, ax
    299	021B  D1 EB D1 EB D1 EB	D1+				     shr bx, 4
    300	      EB
    301	0223  8B C3						     mov ax, bx
    302	0225  AB						     stosw
    303	0226  5B 58						     pop bx ax
    304
    305	0228  E2 00					     loop reg_str							    +
    306				     ;---------------------------------------------------------------|
**Error** resident.asm(189) Relative jump out of range by 0004h	bytes
    307
    308	022A  C3					     ret								    +
    309				     ;return function value
    310	022B						     endp								    +
    311				     ;proc's ending
    312
    313				     ;------------------------------------------------------------------------------
    314
    315				     ;------------------------------------------------------------------------------
    316				     ; ASCII code symbols to hex integer (ABCDEF instead of abcdef)
    317				     ; Entry:		     AL	- first	symbol
    318				     ; Exit:		     BL	- hex
    319				     ; Destroyed:    CX, BX, DX, AX
    320				     ;------------------------------------------------------------------------------
    321
    322	022B			     Atoh    proc
    323
    324	022B  B9 0001				     mov cx, 1									    +
    325				     ;cx = 1
    326	022E  33 DB				     xor bx, bx									    +
    327				     ;bx = 0
    328	0230  33 D2				     xor dx, dx									    +
    329				     ;dx = 0
    330	0232  32 E4				     xor ah, ah									    +
    331				     ;ah = 0
    332
    333	0234					     get_hex:									    +
    334				     ;<--------------------------|
    335	0234  3C 20					     cmp al, ' '							    +
    336				     ;if (al ==	' ') zf	= 1	     |
    337	0236  74 1D					     je	end_atoh							    +
    338				     ;if (zf ==	1) goto	end_atoi     |
    339																    +
    340				     ;							     |
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 7
resident.asm



    341	0238  D1 E3 D1 E3 D1 E3	D1+			     shl bx, 4								    +
    342	      E3		     ;bx *= 16					     |
    343																    +
    344				     ;							     |
    345	0240  3C 41					     cmp al, 'A'							    +
    346				     ;if (al - 65 < 0) fs = 1	     |
    347	0242  79 06					     jns no_sign							    +
    348				     ;if (fs !=	1) goto	no_sign	     |
    349	0244  2D 0030					     sub ax, '0'							    +
    350				     ;ax -= 48					     |
    351	0247  EB 04 90					     jmp both								    +
    352				     ;goto both					     |
    353	024A						     no_sign:								    +
    354				     ;							     |
    355	024A  2D 0037						     sub ax, 55							    +
    356				     ;ax -= 55					     |
    357	024D						     both:								    +
    358				     ;							     |
    359	024D  03 D8					     add bx, ax								    +
    360				     ;bx += ax					     |
    361																    +
    362				     ;							     |
    363	024F  83 C1 02					     add cx, 2								    +
    364				     ;cx += 2					     |
    365	0252  AC					     lodsb								    +
    366				     ;mov al, ds:[si]			     |
    367	0253  E2 DF				     loop get_hex								    +
    368				     ;---------------------------|
    369	0255					     end_atoh:
    370
    371	0255  C3				     ret									    +
    372				     ;return function value
    373	0256					     endp									    +
    374				     ;proc's ending
    375
    376				     ;------------------------------------------------------------------------------
    377
    378				     ;------------------------------------------------------------------------------
    379				     ; ASCII code symbols to integer
    380				     ; Entry:		     AL	- first	symbol
    381				     ; Exit:		     BL	- integer
    382				     ; Destroyed:    CX, BX, DX, AX
    383				     ;------------------------------------------------------------------------------
    384
    385	0256			     Atoi    proc
    386
    387	0256  B9 0001				     mov cx, 1									    +
    388				     ;cx = 1
    389	0259  33 DB				     xor bx, bx									    +
    390				     ;bx = 0
    391	025B  33 D2				     xor dx, dx									    +
    392				     ;dx = 0
    393	025D  32 E4				     xor ah, ah									    +
    394				     ;ah = 0
    395
    396	025F					     get_symbol:								    +
    397				     ;<--------------------------|
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 8
resident.asm



    398	025F  3C 20					     cmp al, ' '							    +
    399				     ;if (al ==	' ') zf	= 1	     |
    400	0261  74 17					     je	end_atoi							    +
    401				     ;if (zf ==	1) goto	end_atoi     |
    402																    +
    403				     ;							     |
    404	0263  53					     push bx								    +
    405				     ;save bx					     |
    406	0264  D1 E3 D1 E3 D1 E3				     shl bx, 3								    +
    407				     ;bx *= 8					     |
    408																    +
    409				     ;							     |
    410	026A  5A					     pop dx								    +
    411				     ;return bx: dx = bx		     |
    412	026B  D1 E2					     shl dx, 1								    +
    413				     ;dx *= 2					     |
    414	026D  03 DA					     add bx, dx								    +
    415				     ;bx += dx					     |
    416																    +
    417				     ;							     |
    418	026F  2D 0030					     sub ax, 48								    +
    419				     ;ax -= 48					     |
    420	0272  03 D8					     add bx, ax								    +
    421				     ;bx += ax					     |
    422																    +
    423				     ;							     |
    424	0274  83 C1 02					     add cx, 2								    +
    425				     ;cx += 2					     |
    426	0277  AC					     lodsb								    +
    427				     ;mov al, ds:[si]			     |
    428	0278  E2 E5				     loop get_symbol								    +
    429				     ;---------------------------|
    430	027A					     end_atoi:
    431
    432	027A  C3				     ret									    +
    433				     ;return function value
    434	027B					     endp									    +
    435				     ;proc's ending
    436
    437				     ;------------------------------------------------------------------------------
    438
    439				     ;------------------------------------------------------------------------------
    440				     ; Calculate values	of variables: x_start, y_start,	y_string
    441				     ; Entry:		     None
    442				     ; Exit:		     None
    443				     ; Destroyed:    AX, BX, DX, BP
    444				     ;------------------------------------------------------------------------------
    445
    446	027B			     CalcParam	     proc
    447
    448							     ;x_start =	window_len - len
    449	027B  A0 0000r					     mov al, len							    +
    450				     ;al = len
    451	027E  B3 50					     mov bl, window_len							    +
    452				     ;bp = 80
    453	0280  88 1E 0003r				     mov x_start, bl							    +
    454				     ;x_start =	80
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 9
resident.asm



    455	0284  28 06 0003r				     sub x_start, al							    +
    456				     ;x_start -= len
    457
    458	0288  C6 06 0004r 02 90				     mov y_start, 2							    +
    459				     ;y_start =	1
    460
    461	028E  8A 1E 0004r				     mov bl, y_start							    +
    462				     ;bp = y_start
    463	0292  FE C3					     inc bl								    +
    464				     ;bl += 1
    465	0294  88 1E 0005r				     mov y_string, bl							    +
    466				     ;y_string = y_start + 1
    467
    468	0298  C3					     ret								    +
    469				     ;return function value
    470	0299						     endp								    +
    471				     ;proc's ending
    472
    473				     ;------------------------------------------------------------------------------
    474
    475				     ;------------------------------------------------------------------------------
    476				     ; Eval shift of frame inside string
    477				     ; Entry:		     CX	= string length
    478				     ; Exit:		     None
    479				     ; Destroyed:    DI, BP, AX, BX
    480				     ;------------------------------------------------------------------------------
    481
    482	0299			     EvalShift	     proc
    483
    484							     ;di = y_string * window_len * 2 + (x_start	+ (cx -	len) / 2) * 2
    485	0299  A0 0005r					     mov al, y_string							    +
    486				     ;al = y_string
    487	029C  D0 E0					     shl al, 1								    +
    488				     ;al *= 2
    489	029E  32 E4					     xor ah, ah								    +
    490				     ;ah = 0
    491	02A0  BD 0050					     mov bp, window_len							    +
    492				     ;bp = 80
    493	02A3  52					     push dx								    +
    494				     ;save size	of frame in stack
    495	02A4  F7 E5					     mul bp								    +
    496				     ;ax = 2 * y_start * 80
    497	02A6  5A					     pop dx								    +
    498				     ;return size of frame from	stack to dxâ‰ˆ
    499	02A7  8B F8					     mov di, ax								    +
    500				     ;di = ax
    501
    502	02A9  32 E4					     xor ah, ah								    +
    503				     ;ah = 0
    504	02AB  32 FF					     xor bh, bh								    +
    505				     ;bh = 0
    506	02AD  A0 0003r					     mov al, x_start							    +
    507				     ;al = x_start
    508	02B0  BD 0000r					     mov bp, offset len							    +
    509				     ;bp = &len
    510	02B3  8A 1E 0000r				     mov bl, len							    +
    511				     ;bl = len
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 10
resident.asm



    512	02B7  2A D9					     sub bl, cl								    +
    513				     ;bl -= cl
    514	02B9  D0 EB					     shr bl, 1								    +
    515				     ;bl = (cx - len) /	2
    516	02BB  02 C3					     add al, bl								    +
    517				     ;x_start += (cx - len) / 2
    518	02BD  D0 E0					     shl al, 1								    +
    519				     ;al *= 2
    520	02BF  03 F8					     add di, ax								    +
    521				     ;di += al
    522
    523	02C1  D1 EF					     shr di, 1								    +
    524				     ;di /= 2
    525	02C3  D1 E7					     shl di, 1								    +
    526				     ;di *= 2
    527
    528	02C5  C3					     ret								    +
    529				     ;return function value
    530	02C6						     endp								    +
    531				     ;proc's ending
    532
    533				     ;------------------------------------------------------------------------------
    534
    535
    536				     ;------------------------------------------------------------------------------
    537				     ; Eval string length with '$' terminal symbol
    538				     ; Entry:		     SI	= data string address
    539				     ; Exit:		     CX
    540				     ; Destroyed:    SI, AL, CX
    541				     ;------------------------------------------------------------------------------
    542
    543	02C6			     StrLen  proc
    544
    545	02C6					     str_len:									    +
    546				     ;<------------------------------|
    547	02C6  AC					     lodsb								    +
    548				     ;mov al, ds:[si]				     |
    549	02C7  3C 24					     cmp al, '$'							    +
    550				     ;if (al ==	'$') zf	= 1		     |
    551	02C9  74 05					     jz	end_str_len							    +
    552				     ;if (zf ==	1) goto	end_str_len  |
    553	02CB  83 C1 02					     add cx, 2								    +
    554				     ;cx += 2						     |
    555	02CE  E2 F6				     loop str_len								    +
    556				     ;-------------------------------|
    557	02D0					     end_str_len:								    +
    558				     ;label of str len ending
    559
    560	02D0  C3				     ret									    +
    561				     ;return function value
    562	02D1					     endp									    +
    563				     ;proc's ending
    564
    565				     ;------------------------------------------------------------------------------
    566
    567				     ;------------------------------------------------------------------------------
    568				     ; Print string inside the frame
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 11
resident.asm



    569				     ; Entry:		     BX	= data string address
    570				     ;				     AH	= string color
    571				     ;				     CX	= string length
    572				     ; Exit:		     None
    573				     ; Destroyed:    BX, AL, DI
    574				     ;------------------------------------------------------------------------------
    575
    576	02D1			     PrintInsideString	     proc
    577
    578	02D1								     print_string:					    +
    579				     ;<----------------------------------|
    580	02D1  AC								     lodsb					    +
    581				     ;mov al, ds:[si]					     |
    582	02D2  AB								     stosw					    +
    583				     ;mov es:[di], ax /	add di,	2	     |
    584	02D3  3C 24								     cmp al, '$'				    +
    585				     ;if (al ==	'$') zf	= 1			     |
    586	02D5  74 02								     jz	end_print_string			    +
    587				     ;if (zf ==	1) goto	end_print_string     |
    588	02D7  E2 F8							     loop print_string					    +
    589				     ;-----------------------------------|
    590	02D9								     end_print_string:					    +
    591				     ;label of print string ending
    592
    593	02D9  C3							     ret						    +
    594				     ;return function value
    595	02DA								     endp						    +
    596				     ;proc's ending
    597
    598				     ;------------------------------------------------------------------------------
    599
    600				     ;------------------------------------------------------------------------------
    601				     ; Draw frame with size: len, height
    602				     ; Entry:		     SI	= data string address
    603				     ;				     DH	= frame	height
    604				     ;				     DL	= frame	len
    605				     ; Exit:		     None
    606				     ; Destroyed:    BX, CX, DI
    607				     ;------------------------------------------------------------------------------
    608
    609	02DA			     DrawFrame	     proc
    610
    611	02DA  A0 0004r					     mov al, y_start							    +
    612				     ;al = y_start
    613	02DD  D0 E0					     shl al, 1								    +
    614				     ;al *= 2
    615	02DF  BD 0050					     mov bp, window_len							    +
    616				     ;bp = 80
    617	02E2  52					     push dx								    +
    618				     ;save size	of frame in stack
    619	02E3  F7 E5					     mul bp								    +
    620				     ;ax = 2 * y_start * 80
    621	02E5  5A					     pop dx								    +
    622				     ;return size of frame from	stack to dx
    623	02E6  8B F8					     mov di, ax								    +
    624				     ;di = ax
    625	02E8  A0 0003r					     mov al, x_start							    +
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 12
resident.asm



    626				     ;ax = x_start
    627	02EB  D0 E0					     shl al, 1								    +
    628				     ;ax *= 2
    629	02ED  32 E4					     xor ah, ah								    +
    630				     ;ah = 0
    631	02EF  03 F8					     add di, ax								    +
    632				     ;di += 2 *	x_start
    633	02F1  E8 001E					     call PrintString							    +
    634				     ;print string
    635
    636	02F4  8A CE					     mov cl, dh								    +
    637				     ;loop on length of	frame string
    638	02F6  32 ED					     xor ch, ch								    +
    639				     ;ch = 0
    640	02F8  83 E9 02					     sub cx, 2								    +
    641				     ;without first and	lsat symbols of	string
    642	02FB						     cycle1:								    +
    643				     ;<--------------------------|
    644	02FB  81 C7 00A0					     add di, window_len	* 2					    +
    645				     ;di += window_len * 2	     |
    646	02FF  E8 0010						     call PrintString						    +
    647				     ;print string			     |
    648	0302  83 EE 03						     sub si, 3							    +
    649				     ;si -= 3					     |
    650	0305  E2 F4					     loop cycle1							    +
    651				     ;---------------------------|
    652	0307  83 C6 03					     add si, 3								    +
    653				     ;si += 3
    654
    655	030A  81 C7 00A0				     add di, window_len	* 2						    +
    656				     ;di += window_len * 2 (next line)
    657	030E  E8 0001					     call PrintString							    +
    658				     ;print string
    659
    660	0311  C3					     ret								    +
    661				     ;return function value
    662	0312						     endp								    +
    663				     ;proc's ending
    664
    665				     ;------------------------------------------------------------------------------
    666
    667				     ;------------------------------------------------------------------------------
    668				     ; Draws string to console in format: s1s2....s2s3
    669				     ; Entry:		     SI	= string address
    670				     ;				     DL	= string len
    671				     ; Exit:		     None
    672				     ; Destroyed:    AX, BX, CX, SI
    673				     ;------------------------------------------------------------------------------
    674
    675	0312			     PrintString     proc
    676
    677	0312  8A 26 0002r				     mov ah, frame_color						    +
    678				     ;set symbols color
    679
    680	0316  AC					     lodsb								    +
    681				     ;mov al, ds:[si]
    682	0317  AB					     stosw								    +
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 13
resident.asm



    683				     ;mov es:[di], ax /	add di,	2
    684
    685	0318  51					     push cx								    +
    686				     ;save prev	loop cnt
    687	0319  8A CA					     mov cl, dl								    +
    688				     ;counter =	dl
    689	031B  80 E9 02					     sub cl, 2								    +
    690				     ;without top and bottom line
    691	031E  8A 04					     mov al, [si]							    +
    692				     ;al = [si]
    693	0320						     cycle:								    +
    694				     ;<------------------------------|
    695	0320  AB						     stosw							    +
    696				     ;mov es:[di], ax /	add di,	2    |
    697	0321  E2 FD					     loop cycle								    +
    698				     ;-------------------------------|
    699	0323  46					     inc si								    +
    700				     ;bx++
    701	0324  59					     pop cx								    +
    702				     ;return prev loop cnt
    703
    704	0325  AC					     lodsb								    +
    705				     ;mov al, ds:[si]
    706	0326  AB					     stosw								    +
    707				     ;mov es:[di], ax /	add di,	2
    708
    709	0327  8A DA					     mov bl, dl								    +
    710				     ;bl = dl
    711	0329  32 FF					     xor bh, bh								    +
    712				     ;bh = 0
    713	032B  D1 E3					     shl bx, 1								    +
    714				     ;bx *= 2
    715	032D  2B FB					     sub di, bx								    +
    716				     ;set di to	line beginning
    717
    718	032F  C3					     ret								    +
    719				     ;return function value
    720	0330						     endp								    +
    721				     ;proc's ending
    722
    723				     ;------------------------------------------------------------------------------
    724
    725	0330			     .data
    726	0000  13		     len			     db	19							    +
    727				     ;frame row	length
    728	0001  07		     height			     db	7							    +
    729				     ;frame column height
    730	0002  4E		     frame_color	     db	4eh								    +
    731				     ;frame element color
    732
    733	0003  00		     x_start			     db	0							    +
    734				     ;x	frame start position
    735	0004  00		     y_start			     db	0							    +
    736				     ;y	frame start position
    737	0005  00		     y_string			     db	0							    +
    738				     ;y	string start position
    739	0006  00		     str_data_pos	     db	0								    +
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 14
resident.asm



    740				     ;cmd line position	of string
    741
    742	0007  C9 CD BB BA 20 BA	C8+  DoubleFrameString	     db	'ÉÍ»º ºÈÍ¼'
    743	      CD BC
    744	0010  61 78 20 30 30 30	30+  AXString			     db	"ax 0000$"
    745	      24
    746	0018  62 78 20 30 30 30	30+  BXString			     db	"bx 0000$"
    747	      24
    748	0020  63 78 20 30 30 30	30+  CXString			     db	"cx 0000$"
    749	      24
    750	0028  64 78 20 30 30 30	30+  DXString			     db	"dx 0000$"
    751	      24
    752
    753	0030			     EOP:
    754				     end     Start										    +
    755				     ;prog's ending
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 15
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/24/25"
??FILENAME			  Text	 "resident"
??TIME				  Text	 "03:30:40"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _DATA
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 RESIDENT
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ATOH				  Near	 DGROUP:022B
ATOI				  Near	 DGROUP:0256
AXSTRING			  Byte	 DGROUP:0010
BOTH				  Near	 DGROUP:024D
BXSTRING			  Byte	 DGROUP:0018
CALCPARAM			  Near	 DGROUP:027B
CMD_LINE_ADD			  Number 0081
CXSTRING			  Byte	 DGROUP:0020
CYCLE				  Near	 DGROUP:0320
CYCLE1				  Near	 DGROUP:02FB
DOUBLEFRAMESTRING		  Byte	 DGROUP:0007
DRAWFRAME			  Near	 DGROUP:02DA
DRAWSTRING			  Near	 DGROUP:01A3
DXSTRING			  Byte	 DGROUP:0028
END_ATOH			  Near	 DGROUP:0255
END_ATOI			  Near	 DGROUP:027A
END_PRINT_STRING		  Near	 DGROUP:02D9
END_STR_LEN			  Near	 DGROUP:02D0
EOP				  Near	 DGROUP:0030
EVALSHIFT			  Near	 DGROUP:0299
FRAME_COLOR			  Byte	 DGROUP:0002
GET_HEX				  Near	 DGROUP:0234
GET_SYMBOL			  Near	 DGROUP:025F
HEIGHT				  Byte	 DGROUP:0001
LEN				  Byte	 DGROUP:0000
MAINBORDER			  Near	 DGROUP:0170
NEW09H				  Near	 DGROUP:0130
NO_SIGN				  Near	 DGROUP:024A
OLD09OFS			  Word	 DGROUP:016C
OLD09SEG			  Word	 DGROUP:016E
PRINTINSIDESTRING		  Near	 DGROUP:02D1
PRINTSTRING			  Near	 DGROUP:0312
PRINT_STRING			  Near	 DGROUP:02D1
REG_IN_FRAME			  Number 0004
REG_STR				  Near	 DGROUP:01A6
SETSTYLE			  Near	 DGROUP:0194
SKIP				  Near	 DGROUP:0154
START				  Near	 DGROUP:0100
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 16
Symbol Table



STRLEN				  Near	 DGROUP:02C6
STR_DATA_POS			  Byte	 DGROUP:0006
STR_LEN				  Near	 DGROUP:02C6
VIDEO_SEGMENT			  Number B800
WINDOW_HEIGHT			  Number 0019
WINDOW_LEN			  Number 0050
X_START				  Byte	 DGROUP:0003
Y_START				  Byte	 DGROUP:0004
Y_STRING			  Byte	 DGROUP:0005

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0030 Word	  Public  DATA
  _TEXT				  16  0330 Word	  Public  CODE
Turbo Assembler	 Version 4.1	    02/24/25 03:30:40	    Page 17
Error Summary



**Error** resident.asm(163) Rotate count out of	range
**Error** resident.asm(189) Relative jump out of range by 0004h	bytes
